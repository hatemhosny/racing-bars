{"version":3,"file":"racing-bars.umd.js","sources":["../../src/lib/load-data.ts","../../src/lib/options/options.actions.ts","../../src/lib/options/options.models.ts","../../src/lib/data/data.actions.ts","../../src/lib/data/data.reducer.ts","../../src/lib/ticker/ticker.actions.ts","../../src/lib/ticker/ticker.reducer.ts","../../src/lib/ticker/ticker.ts","../../src/lib/store/actions.ts","../../src/lib/store/reducer.ts","../../src/lib/store/store.ts","../../src/lib/utils/utils.ts","../../src/lib/utils/dates.ts","../../src/lib/utils/data.ts","../../src/lib/options/options.reducer.ts","../../src/lib/renderer/calculate-dimensions.ts","../../src/lib/renderer/helpers.ts","../../src/lib/renderer/render-header.ts","../../src/lib/renderer/elements.ts","../../src/lib/renderer/buttons.ts","../../src/lib/renderer/controls.ts","../../src/lib/renderer/render-initial-view.ts","../../src/lib/renderer/render-frame.ts","../../src/lib/renderer/resize.ts","../../src/lib/renderer/create-renderer.ts","../../src/lib/renderer/renderer-subscriber.ts","../../src/lib/styles/generated-styles.ts","../../src/lib/styles/style-inject.ts","../../src/lib/events/events.ts","../../src/lib/race.ts","../../src/shared/index.ts"],"sourcesContent":["import * as d3 from './d3';\r\nimport { Data, WideData } from './data';\r\n\r\nexport function loadData(\r\n  URL: string,\r\n  type: 'json' | 'csv' | 'tsv' | 'xml' = 'json',\r\n): Promise<Data[]> | Promise<WideData[]> {\r\n  switch (type) {\r\n    case 'json':\r\n      return d3.json(URL) as Promise<Data[]> | Promise<WideData[]>;\r\n    case 'csv':\r\n      return (d3.csv(URL) as unknown) as Promise<Data[]> | Promise<WideData[]>;\r\n    case 'tsv':\r\n      return (d3.tsv(URL) as unknown) as Promise<Data[]> | Promise<WideData[]>;\r\n    case 'xml':\r\n      return (d3.xml(URL) as unknown) as Promise<Data[]> | Promise<WideData[]>;\r\n    default:\r\n      throw new Error(`Unsupported data type: ${type}`);\r\n  }\r\n}\r\n","import { Options, OptionsAction } from './options.models';\r\n\r\nexport const actionTypes = {\r\n  loadOptions: 'options/load',\r\n  changeOptions: 'options/change',\r\n};\r\n\r\nexport const loadOptions = (options: Partial<Options>): OptionsAction => ({\r\n  type: actionTypes.loadOptions,\r\n  payload: options,\r\n});\r\n\r\nexport const changeOptions = (options: Partial<Options>): OptionsAction => ({\r\n  type: actionTypes.changeOptions,\r\n  payload: options,\r\n});\r\n","import { Action } from '../store';\r\nimport { Data, WideData } from '../data';\r\n\r\nexport interface OptionsAction extends Action {\r\n  payload: Partial<Options>;\r\n}\r\n\r\nexport class Options {\r\n  public selector!: string;\r\n  public dataShape!: 'long' | 'wide';\r\n  public dataTransform!: null | TransformFn;\r\n  public fillDateGapsInterval!: null | 'year' | 'month' | 'day';\r\n  public fillDateGapsValue!: 'last' | 'interpolate';\r\n  public title!: string;\r\n  public subTitle!: string;\r\n  public dateCounter!: string | ParamFunction;\r\n  public startDate!: string;\r\n  public endDate!: string;\r\n  public loop!: boolean;\r\n  public caption!: string;\r\n  public labelsPosition!: 'inside' | 'outside';\r\n  public labelsWidth!: number;\r\n  public showIcons!: boolean;\r\n  public colorSeed!: string | number;\r\n  public showGroups!: boolean;\r\n  public tickDuration!: number;\r\n  public topN!: number;\r\n  public inputHeight!: string;\r\n  public inputWidth!: string;\r\n  public minHeight!: number;\r\n  public minWidth!: number;\r\n  public height!: string;\r\n  public width!: string;\r\n  public marginTop!: number;\r\n  public marginRight!: number;\r\n  public marginBottom!: number;\r\n  public marginLeft!: number;\r\n  public mouseControls!: boolean;\r\n  public keyboardControls!: boolean;\r\n  public controlButtons!: 'all' | 'play' | 'none';\r\n  public overlays!: 'all' | 'play' | 'repeat' | 'none';\r\n  public autorun!: boolean;\r\n  public injectStyles!: boolean;\r\n  public theme!: string;\r\n  public colorMap!: { [key: string]: string } | string[];\r\n  public fixedScale!: boolean;\r\n  public fixedOrder!: string[];\r\n  public highlightBars!: boolean;\r\n  public selectBars!: boolean;\r\n}\r\n\r\nexport type TransformFn = (data: Data[] | WideData[]) => Data[] | WideData[];\r\n\r\nexport type ParamFunction = (currentDate: string, dateSlice: Data[], allDates: string[]) => string;\r\n","import { DataAction, DataCollections, Data, DateSlice } from './data.models';\r\n\r\nexport const actionTypes = {\r\n  dataLoaded: 'data/loaded',\r\n  addFilter: 'data/addFilter',\r\n  removeFilter: 'data/removeFilter',\r\n  toggleFilter: 'data/toggleFilter',\r\n  resetFilters: 'data/resetFilters',\r\n  allExceptFilter: 'data/allExceptFilter',\r\n  addSelection: 'data/addSelection',\r\n  removeSelection: 'data/removeSelection',\r\n  toggleSelection: 'data/toggleSelection',\r\n  resetSelections: 'data/resetSelections',\r\n  addDateSlice: 'data/addDateSlice',\r\n  clearDateSlices: 'data/clearDateSlices',\r\n};\r\n\r\nexport const dataLoaded = (dataCollections: DataCollections): DataAction => ({\r\n  type: actionTypes.dataLoaded,\r\n  payload: dataCollections,\r\n});\r\n\r\nexport const addFilter = (group: string): DataAction => ({\r\n  type: actionTypes.addFilter,\r\n  payload: group,\r\n});\r\n\r\nexport const removeFilter = (group: string): DataAction => ({\r\n  type: actionTypes.removeFilter,\r\n  payload: group,\r\n});\r\n\r\nexport const toggleFilter = (group: string): DataAction => ({\r\n  type: actionTypes.toggleFilter,\r\n  payload: group,\r\n});\r\n\r\nexport const resetFilters = (): DataAction => ({\r\n  type: actionTypes.resetFilters,\r\n});\r\n\r\nexport const allExceptFilter = (group: string): DataAction => ({\r\n  type: actionTypes.allExceptFilter,\r\n  payload: group,\r\n});\r\n\r\nexport const addSelection = (selection: string): DataAction => ({\r\n  type: actionTypes.addSelection,\r\n  payload: selection,\r\n});\r\n\r\nexport const removeSelection = (selection: string): DataAction => ({\r\n  type: actionTypes.removeSelection,\r\n  payload: selection,\r\n});\r\n\r\nexport const toggleSelection = (selection: string): DataAction => ({\r\n  type: actionTypes.toggleSelection,\r\n  payload: selection,\r\n});\r\n\r\nexport const resetSelections = (): DataAction => ({\r\n  type: actionTypes.resetSelections,\r\n});\r\n\r\nexport const addDateSlice = (date: string, dateSlice: Data[]): DataAction => {\r\n  const payload: DateSlice = {};\r\n  payload[date] = dateSlice;\r\n  return {\r\n    type: actionTypes.addDateSlice,\r\n    payload,\r\n    triggerRender: false,\r\n  };\r\n};\r\n\r\nexport const clearDateSlices = (): DataAction => ({\r\n  type: actionTypes.clearDateSlices,\r\n});\r\n","import { Reducer } from '../store';\r\nimport { actionTypes } from './data.actions';\r\nimport { DataState, DataAction, DataCollections, DateSlice } from './data.models';\r\n\r\nconst initialState: DataState = {\r\n  names: [],\r\n  groups: [],\r\n  datesCache: [],\r\n  groupFilter: [],\r\n  selected: [],\r\n  dateSlices: {},\r\n};\r\n\r\nexport const dataReducer: Reducer<DataState, DataAction> = (state = initialState, action) => {\r\n  switch (action.type) {\r\n    case actionTypes.dataLoaded:\r\n      return {\r\n        ...state,\r\n        names: [...(action.payload as DataCollections).names],\r\n        groups: [...(action.payload as DataCollections).groups],\r\n        datesCache: [...(action.payload as DataCollections).datesCache],\r\n      };\r\n\r\n    case actionTypes.addFilter:\r\n      return {\r\n        ...state,\r\n        groupFilter: addToArray(state.groupFilter, action.payload as string),\r\n      };\r\n\r\n    case actionTypes.removeFilter:\r\n      return {\r\n        ...state,\r\n        groupFilter: removeFromArray(state.groupFilter, action.payload as string),\r\n      };\r\n\r\n    case actionTypes.toggleFilter:\r\n      return {\r\n        ...state,\r\n        groupFilter: toggleItem(state.groupFilter, action.payload as string),\r\n      };\r\n\r\n    case actionTypes.resetFilters:\r\n      return {\r\n        ...state,\r\n        groupFilter: [],\r\n      };\r\n\r\n    case actionTypes.allExceptFilter:\r\n      return {\r\n        ...state,\r\n        groupFilter: removeFromArray(state.groups, action.payload as string),\r\n      };\r\n\r\n    case actionTypes.addSelection:\r\n      return {\r\n        ...state,\r\n        selected: addToArray(state.selected, action.payload as string),\r\n      };\r\n\r\n    case actionTypes.removeSelection:\r\n      return {\r\n        ...state,\r\n        selected: removeFromArray(state.selected, action.payload as string),\r\n      };\r\n\r\n    case actionTypes.toggleSelection:\r\n      return {\r\n        ...state,\r\n        selected: toggleItem(state.selected, action.payload as string),\r\n      };\r\n\r\n    case actionTypes.resetSelections:\r\n      return {\r\n        ...state,\r\n        selected: [],\r\n      };\r\n\r\n    case actionTypes.addDateSlice:\r\n      return {\r\n        ...state,\r\n        dateSlices: {\r\n          ...state.dateSlices,\r\n          ...(action.payload as DateSlice),\r\n        },\r\n      };\r\n\r\n    case actionTypes.clearDateSlices:\r\n      return {\r\n        ...state,\r\n        dateSlices: {},\r\n      };\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nfunction addToArray(array: string[], item: string) {\r\n  const arr = [...array];\r\n  if (!arr.includes(item)) {\r\n    arr.push(item);\r\n  }\r\n  return arr;\r\n}\r\n\r\nfunction removeFromArray(array: string[], item: string) {\r\n  return array.filter((x) => x !== item);\r\n}\r\n\r\nfunction toggleItem(array: string[], item: string) {\r\n  return array.includes(item) ? removeFromArray(array, item) : addToArray(array, item);\r\n}\r\n","import { TickerAction } from './ticker.models';\r\n\r\nexport const actionTypes = {\r\n  initialize: 'ticker/initialize',\r\n  changeDates: 'ticker/changeDates',\r\n  updateDate: 'ticker/updateDate',\r\n  setRunning: 'ticker/setRunning',\r\n  setFirst: 'ticker/setFirst',\r\n  setLast: 'ticker/setLast',\r\n  inc: 'ticker/inc',\r\n  dec: 'ticker/dec',\r\n};\r\n\r\nexport const initialize = (dates: string[]): TickerAction => ({\r\n  type: actionTypes.initialize,\r\n  payload: dates,\r\n});\r\n\r\nexport const changeDates = (dates: string[]): TickerAction => ({\r\n  type: actionTypes.changeDates,\r\n  payload: dates,\r\n});\r\n\r\nexport const updateDate = (currentDate: string): TickerAction => ({\r\n  type: actionTypes.updateDate,\r\n  payload: currentDate,\r\n});\r\n\r\nexport const setRunning = (running: boolean): TickerAction => ({\r\n  type: actionTypes.setRunning,\r\n  payload: running,\r\n});\r\n\r\nexport const setFirst = (): TickerAction => ({\r\n  type: actionTypes.setFirst,\r\n});\r\n\r\nexport const setLast = (): TickerAction => ({\r\n  type: actionTypes.setLast,\r\n});\r\n\r\nexport const inc = (value = 1): TickerAction => ({\r\n  type: actionTypes.inc,\r\n  payload: value,\r\n});\r\n\r\nexport const dec = (value = 1): TickerAction => ({\r\n  type: actionTypes.dec,\r\n  payload: value,\r\n});\r\n","import { Reducer } from '../store';\r\nimport { TickerState, TickerAction } from './ticker.models';\r\nimport { actionTypes } from './ticker.actions';\r\n\r\nconst initialState: TickerState = {\r\n  isRunning: false,\r\n  currentDate: '',\r\n  isFirstDate: true,\r\n  isLastDate: false,\r\n  dates: [],\r\n};\r\n\r\nexport const tickerReducer: Reducer<TickerState, TickerAction> = (state = initialState, action) => {\r\n  switch (action.type) {\r\n    case actionTypes.initialize: {\r\n      const dates = action.payload as string[];\r\n      return {\r\n        ...state,\r\n        isRunning: false,\r\n        currentDate: dates[0],\r\n        isFirstDate: true,\r\n        isLastDate: false,\r\n        dates,\r\n      };\r\n    }\r\n\r\n    case actionTypes.changeDates: {\r\n      const dates = action.payload as string[];\r\n      const currentDate =\r\n        dates.indexOf(state.currentDate) !== -1\r\n          ? state.currentDate\r\n          : state.currentDate < dates[0]\r\n          ? dates[0]\r\n          : state.currentDate > dates[dates.length - 1]\r\n          ? dates[dates.length - 1]\r\n          : dates[[...dates, state.currentDate].sort().indexOf(state.currentDate)];\r\n      return {\r\n        ...state,\r\n        currentDate,\r\n        isFirstDate: currentDate === dates[0],\r\n        isLastDate: currentDate === dates[state.dates.length - 1],\r\n        dates,\r\n      };\r\n    }\r\n\r\n    case actionTypes.updateDate: {\r\n      const currentDate = action.payload as string;\r\n      if (state.dates.indexOf(currentDate) === -1) {\r\n        return { ...state };\r\n      }\r\n      return {\r\n        ...state,\r\n        currentDate,\r\n        isFirstDate: currentDate === state.dates[0],\r\n        isLastDate: currentDate === state.dates[state.dates.length - 1],\r\n      };\r\n    }\r\n\r\n    case actionTypes.setRunning: {\r\n      return {\r\n        ...state,\r\n        isRunning: action.payload as boolean,\r\n      };\r\n    }\r\n\r\n    case actionTypes.setFirst: {\r\n      return {\r\n        ...state,\r\n        currentDate: state.dates[0],\r\n        isFirstDate: true,\r\n        isLastDate: false,\r\n      };\r\n    }\r\n\r\n    case actionTypes.setLast: {\r\n      return {\r\n        ...state,\r\n        currentDate: state.dates[state.dates.length - 1],\r\n        isFirstDate: false,\r\n        isLastDate: true,\r\n      };\r\n    }\r\n\r\n    case actionTypes.inc: {\r\n      const currentIndex = state.dates.indexOf(state.currentDate);\r\n      const lastIndex = state.dates.length - 1;\r\n      const incValue = action.payload as number;\r\n      const newDate =\r\n        currentIndex + incValue > lastIndex\r\n          ? state.dates[lastIndex]\r\n          : state.dates[currentIndex + incValue];\r\n      return {\r\n        ...state,\r\n        currentDate: newDate,\r\n        isFirstDate: newDate === state.dates[0],\r\n        isLastDate: newDate === state.dates[lastIndex],\r\n      };\r\n    }\r\n\r\n    case actionTypes.dec: {\r\n      const currentIndex = state.dates.indexOf(state.currentDate);\r\n      const decValue = action.payload as number;\r\n      const newDate =\r\n        currentIndex - decValue < 0 ? state.dates[0] : state.dates[currentIndex - decValue];\r\n      return {\r\n        ...state,\r\n        currentDate: newDate,\r\n        isFirstDate: newDate === state.dates[0],\r\n        isLastDate: newDate === state.dates[state.dates.length - 1],\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import * as d3 from '../d3';\r\nimport { actions, Store } from '../store';\r\nimport { Ticker } from './ticker.models';\r\n\r\nexport function createTicker(store: Store): Ticker {\r\n  let ticker: d3.Timer;\r\n\r\n  function start() {\r\n    let justStarted = true;\r\n    ticker = d3.interval(showRace, store.getState().options.tickDuration);\r\n    store.dispatch(actions.ticker.setRunning(true));\r\n\r\n    function showRace(_: number) {\r\n      if (!store.getState().ticker.isLastDate) {\r\n        store.dispatch(actions.ticker.inc());\r\n      } else {\r\n        if (store.getState().options.loop || justStarted) {\r\n          loop();\r\n        } else {\r\n          stop();\r\n        }\r\n      }\r\n      justStarted = false;\r\n    }\r\n  }\r\n\r\n  function stop() {\r\n    if (ticker) {\r\n      ticker.stop();\r\n    }\r\n    store.dispatch(actions.ticker.setRunning(false));\r\n  }\r\n\r\n  function skipBack() {\r\n    stop();\r\n    store.dispatch(actions.ticker.setFirst());\r\n  }\r\n\r\n  function loop() {\r\n    store.dispatch(actions.ticker.setFirst());\r\n  }\r\n\r\n  function skipForward() {\r\n    stop();\r\n    store.dispatch(actions.ticker.setLast());\r\n    store.dispatch(actions.ticker.setLast()); // workaround to avoid showing lastValue\r\n  }\r\n\r\n  function toggle() {\r\n    if (store.getState().ticker.isLastDate) {\r\n      skipBack();\r\n      start();\r\n    } else if (store.getState().ticker.isRunning) {\r\n      stop();\r\n    } else {\r\n      start();\r\n    }\r\n  }\r\n\r\n  function goToDate(date: string) {\r\n    store.dispatch(actions.ticker.updateDate(date));\r\n  }\r\n\r\n  return {\r\n    start,\r\n    stop,\r\n    skipBack,\r\n    loop,\r\n    skipForward,\r\n    toggle,\r\n    goToDate,\r\n  };\r\n}\r\n","import * as data from '../data';\r\nimport * as options from '../options';\r\nimport * as ticker from '../ticker';\r\n\r\nexport const actions = {\r\n  data,\r\n  options,\r\n  ticker,\r\n};\r\n","import { optionsReducer, OptionsAction } from '../options';\r\nimport { tickerReducer, TickerAction } from '../ticker';\r\nimport { dataReducer, DataAction } from '../data';\r\nimport { Action, State, Reducer } from './models';\r\n\r\nexport const rootReducer: Reducer<State, Action> = (state, action) => ({\r\n  data: dataReducer(state.data, action as DataAction),\r\n  options: optionsReducer(state.options, action as OptionsAction),\r\n  ticker: tickerReducer(state.ticker, action as TickerAction),\r\n  triggerRender: action.triggerRender ?? true,\r\n});\r\n","import { Action, Reducer, State, Subscriber, Store } from './models';\r\nimport { rootReducer } from './reducer';\r\n\r\nexport function createStore(\r\n  reducer: Reducer<State, Action> = rootReducer,\r\n  preloadedState?: State,\r\n): Store {\r\n  let state = {} as State;\r\n\r\n  if (preloadedState) {\r\n    state = preloadedState;\r\n  }\r\n\r\n  function dispatch(action: Action) {\r\n    state = reducer(state, action);\r\n    notifySubscribers();\r\n    return action;\r\n  }\r\n\r\n  function getState() {\r\n    return state;\r\n  }\r\n\r\n  const subscribers: Subscriber[] = [];\r\n\r\n  function subscribe(fn: Subscriber) {\r\n    subscribers.push(fn);\r\n    const index = subscribers.length - 1;\r\n\r\n    return {\r\n      unsubscribe: () => {\r\n        subscribers.splice(index, 1);\r\n      },\r\n    };\r\n  }\r\n\r\n  function notifySubscribers() {\r\n    subscribers.forEach((fn: Subscriber) => {\r\n      fn();\r\n    });\r\n  }\r\n\r\n  function unsubscribeAll() {\r\n    subscribers.length = 0;\r\n  }\r\n\r\n  return {\r\n    getState,\r\n    dispatch,\r\n    subscribe,\r\n    unsubscribeAll,\r\n  };\r\n}\r\n","import * as d3 from '../d3';\r\n\r\nimport { Data } from '../data';\r\nimport { ParamFunction } from '../options';\r\nimport { Store } from '../store';\r\nimport { formatDate } from './dates';\r\n\r\nexport function getColor(d: Data, store: Store) {\r\n  const { names, groups } = store.getState().data;\r\n  const { showGroups, colorSeed, colorMap } = store.getState().options;\r\n\r\n  if (d.color) {\r\n    return d.color;\r\n  }\r\n\r\n  const useGroup = Boolean(d.group) && showGroups && groups.length > 0;\r\n  let values = useGroup ? groups : names;\r\n  if (colorSeed) {\r\n    values = shuffle(values, toNumber(colorSeed));\r\n  }\r\n  const currentValue = (useGroup ? d.group : d.name) as string;\r\n  let index = values.indexOf(currentValue);\r\n\r\n  if (colorMap) {\r\n    if (Array.isArray(colorMap)) {\r\n      while (index > colorMap.length - 1) {\r\n        index = index - colorMap.length;\r\n      }\r\n      return colorMap[index];\r\n    } else {\r\n      if (colorMap[currentValue]) {\r\n        return colorMap[currentValue];\r\n      }\r\n    }\r\n  }\r\n\r\n  const negativeIfOdd = index % 2 === 0 ? 1 : -1;\r\n  const lumVariation = (random(currentValue) / 10) * negativeIfOdd;\r\n  const HueSpacing = 360 / (values.length + 1);\r\n  const hue = (values.indexOf(currentValue) + 1) * HueSpacing;\r\n  return d3.hsl(hue, 0.75, 0.75 + lumVariation);\r\n}\r\n\r\nexport function getIconID(d: Data) {\r\n  return 'icon-' + safeName(d.name);\r\n}\r\n\r\nexport function zeroPad(n: string, w: number) {\r\n  while (n.toString().length < w) {\r\n    n = '0' + n;\r\n  }\r\n  return n;\r\n}\r\n\r\nfunction toNumber(s: string | number) {\r\n  s = String(s);\r\n  let nums = '';\r\n  for (let i = 0; i < s.length; i++) {\r\n    nums += zeroPad(String(s.charCodeAt(i)), 3);\r\n  }\r\n  return +nums;\r\n}\r\n\r\nexport function random(InputSeed: string | number) {\r\n  const seed = toNumber(InputSeed);\r\n  const x = Math.sin(seed) * 10000;\r\n  return x - Math.floor(x);\r\n}\r\n\r\nexport function shuffle(arr: string[], seed: number) {\r\n  const array = [...arr];\r\n  let m = array.length;\r\n  let t: string;\r\n  let i: number;\r\n\r\n  while (m) {\r\n    i = Math.floor(random(seed) * m--);\r\n    t = array[m];\r\n    array[m] = array[i];\r\n    array[i] = t;\r\n    ++seed;\r\n  }\r\n\r\n  return array;\r\n}\r\n\r\nexport function generateId(prefix = 'racingbars', n = 8) {\r\n  const rnd = Array(3)\r\n    .fill(null)\r\n    .map(() => Math.random().toString(36).substr(2))\r\n    .join('');\r\n  return prefix + rnd.slice(-n);\r\n}\r\n\r\nexport function getHeight(element: HTMLElement, minHeight: number, height?: string) {\r\n  let newHeight: number;\r\n  if (!height) {\r\n    newHeight = element.getBoundingClientRect().height;\r\n  } else if (String(height).startsWith('window')) {\r\n    const scale = +height.split('*')[1] || 1;\r\n    newHeight = window.innerHeight * scale;\r\n  } else {\r\n    newHeight = +height;\r\n  }\r\n  return newHeight > minHeight ? newHeight : minHeight;\r\n}\r\n\r\nexport function getWidth(element: HTMLElement, minWidth: number, width?: string) {\r\n  let newWidth: number;\r\n  if (!width) {\r\n    newWidth = element.getBoundingClientRect().width;\r\n  } else if (String(width).startsWith('window')) {\r\n    const scale = +width.split('*')[1] || 1;\r\n    newWidth = window.innerWidth * scale;\r\n  } else {\r\n    newWidth = +width;\r\n  }\r\n  return newWidth > minWidth ? newWidth : minWidth;\r\n}\r\n\r\nexport function getElement(root: HTMLElement | HTMLDocument, className: string) {\r\n  if (!root) return undefined;\r\n  return (className ? root.querySelector('.' + className) : root) as HTMLElement;\r\n}\r\n\r\nexport function showElement(root: HTMLElement, className: string, useVisibility = false) {\r\n  const element = getElement(root, className);\r\n  if (element) {\r\n    if (useVisibility) {\r\n      element.style.visibility = 'unset';\r\n    } else {\r\n      element.style.display = 'flex';\r\n    }\r\n  }\r\n}\r\n\r\nexport function hideElement(root: HTMLElement, className: string, useVisibility = false) {\r\n  const element = getElement(root, className);\r\n  if (element) {\r\n    if (useVisibility) {\r\n      element.style.visibility = 'hidden';\r\n    } else {\r\n      element.style.display = 'none';\r\n    }\r\n  }\r\n}\r\n\r\nexport function removeElement(root: HTMLElement, className: string) {\r\n  const element = getElement(root, className);\r\n  if (element) {\r\n    element.remove();\r\n  }\r\n}\r\n\r\nexport function getText(\r\n  param: string | ParamFunction,\r\n  currentDate: string,\r\n  dateSlice: Data[],\r\n  dates: string[],\r\n  isDate = false,\r\n): string {\r\n  if (typeof param === 'function') {\r\n    return param(currentDate, dateSlice, dates);\r\n  }\r\n  if (isDate) {\r\n    return formatDate(currentDate, param);\r\n  }\r\n  return param;\r\n}\r\n\r\nexport function safeName(name: string) {\r\n  // replace non-alphanumeric with underscore\r\n  return name.replace(/[\\W]+/g, '_');\r\n}\r\n\r\nexport function toggleClass(root: HTMLElement, selector: string, className: string) {\r\n  d3.select(root)\r\n    .select(selector)\r\n    .classed(className, function () {\r\n      return !d3.select(this).classed(className);\r\n    });\r\n}\r\n\r\nfunction debounce(func: any, wait: number, immediate = false) {\r\n  let timeout: any;\r\n  return function (_clicks: any, _Fn: (clicks: number) => void) {\r\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n    const context = this;\r\n    const args = arguments;\r\n    const later = function () {\r\n      timeout = null;\r\n      if (!immediate) {\r\n        func.apply(context, args);\r\n      }\r\n    };\r\n    const callNow = immediate && !timeout;\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n    if (callNow) {\r\n      func.apply(context, args);\r\n    }\r\n  };\r\n}\r\n\r\nexport const getClicks = debounce(function (event: any, Fn: (event: any) => void) {\r\n  Fn(event);\r\n}, 250);\r\n\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nexport const pipe = (...fns: Function[]) => fns.reduce((f, g) => (...args: any) => g(f(...args)));\r\n","import * as d3 from '../d3';\r\nimport { Data } from '../data';\r\nimport { zeroPad } from './utils';\r\n\r\nexport const getDates = (data: Data[]) => Array.from(new Set(data.map((d) => d.date))).sort();\r\n\r\nexport function getDateString(inputDate: string | Date) {\r\n  const date = new Date(inputDate);\r\n  if (isNaN(+date)) {\r\n    throw new Error(`\"${inputDate}\" is not a valid date`);\r\n  }\r\n\r\n  const year = date.getFullYear().toString();\r\n  const month = zeroPad((1 + date.getMonth()).toString(), 2);\r\n  const day = zeroPad(date.getDate().toString(), 2);\r\n\r\n  return `${year}-${month}-${day}`;\r\n}\r\n\r\nexport function formatDate(dateStr: string, format = 'YYYY-MM-DD') {\r\n  const year = dateStr.slice(0, 4);\r\n  const month = dateStr.slice(5, 7);\r\n  const day = dateStr.slice(8, 10);\r\n  const date = new Date(dateStr);\r\n  const weekDayIndex = String(date.getDay());\r\n  const monthNames: { [key: string]: string } = {\r\n    '01': 'Jan',\r\n    '02': 'Feb',\r\n    '03': 'Mar',\r\n    '04': 'Apr',\r\n    '05': 'May',\r\n    '06': 'Jun',\r\n    '07': 'Jul',\r\n    '08': 'Aug',\r\n    '09': 'Sep',\r\n    '10': 'Oct',\r\n    '11': 'Nov',\r\n    '12': 'Dec',\r\n  };\r\n\r\n  const weekDays: { [key: string]: string } = {\r\n    '0': 'Sun',\r\n    '1': 'Mon',\r\n    '2': 'Tue',\r\n    '3': 'Wed',\r\n    '4': 'Thu',\r\n    '5': 'Fri',\r\n    '6': 'Sat',\r\n  };\r\n\r\n  return format\r\n    .replace('MMM', monthNames[month])\r\n    .replace('DDD', weekDays[weekDayIndex])\r\n    .replace('YYYY', year)\r\n    .replace('MM', month)\r\n    .replace('DD', day);\r\n}\r\n\r\nexport function getDateRange(date1: Date, date2: Date, interval: 'year' | 'month' | 'day') {\r\n  const range = [date1, ...d3.timeDay.range(date1, date2)];\r\n\r\n  const daysInMonth = (date: Date) =>\r\n    new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();\r\n\r\n  const sameDay = date1.getDate() === date2.getDate();\r\n  const sameMonth = date1.getMonth() === date2.getMonth();\r\n\r\n  const numberOfMonths = d3.timeMonth.count(date1, date2);\r\n  const numberOfYears = d3.timeYear.count(date1, date2);\r\n\r\n  let outputRange: Date[] = [];\r\n\r\n  if (interval === 'year') {\r\n    if (sameMonth && sameDay) {\r\n      outputRange = range.filter((date) => {\r\n        if (date.getMonth() === date1.getMonth()) {\r\n          if (date.getDate() === date1.getDate()) return true;\r\n          if (date1.getDate() > daysInMonth(date)) {\r\n            return date.getDate() === daysInMonth(date);\r\n          }\r\n        }\r\n        return false;\r\n      });\r\n    } else {\r\n      outputRange = range.filter(\r\n        (date) => range.indexOf(date) % Math.round(range.length / numberOfYears) === 0,\r\n      );\r\n    }\r\n  } else if (interval === 'month') {\r\n    if (sameDay) {\r\n      outputRange = range.filter((date) => {\r\n        if (date.getDate() === date1.getDate()) return true;\r\n        if (date1.getDate() > daysInMonth(date)) {\r\n          return date.getDate() === daysInMonth(date);\r\n        }\r\n        return false;\r\n      });\r\n    } else {\r\n      outputRange = range.filter(\r\n        (date) => range.indexOf(date) % Math.round(range.length / numberOfMonths) === 0,\r\n      );\r\n    }\r\n  } else if (interval === 'day') {\r\n    outputRange = range;\r\n  }\r\n\r\n  if (outputRange.length === 0) {\r\n    outputRange = [date1, date2];\r\n  }\r\n  if (getDateString(date1) !== getDateString(outputRange[0])) {\r\n    outputRange = [date1, ...outputRange];\r\n  }\r\n  if (getDateString(date2) !== getDateString(outputRange[outputRange.length - 1])) {\r\n    outputRange = [...outputRange, date2];\r\n  }\r\n\r\n  return outputRange;\r\n}\r\n\r\nexport function getNextDate(dates: string[], currentDate: string) {\r\n  const currentIndex = dates.indexOf(currentDate);\r\n  if (currentIndex === -1) return dates[0];\r\n  const lastIndex = dates.length - 1;\r\n  return currentIndex === lastIndex ? dates[0] : dates[currentIndex + 1];\r\n}\r\n","import * as d3 from '../d3';\r\n\r\nimport { Data, WideData } from '../data';\r\nimport { actions, Store } from '../store';\r\nimport { Options, TransformFn } from '../options';\r\nimport { getDateString, getDates, getDateRange, getNextDate } from './dates';\r\nimport { pipe } from './utils';\r\n\r\nexport function prepareData(\r\n  data: Data[] | WideData[],\r\n  store: Store,\r\n  changingOptions = false,\r\n): Data[] {\r\n  const options = store.getState().options;\r\n  return pipe(\r\n    customDataTransform(options.dataTransform),\r\n    filterByDate(options.startDate, options.endDate),\r\n    wideDataToLong(options.dataShape),\r\n    processFixedOrder(options.fixedOrder),\r\n    validateAndSort,\r\n    fillDateGaps(options.fillDateGapsInterval, options.fillDateGapsValue, options.topN),\r\n    calculateLastValues,\r\n    storeDataCollections(store, changingOptions),\r\n  )(data);\r\n}\r\n\r\nfunction customDataTransform(transformFn: TransformFn | null) {\r\n  return function (data: Data[] | WideData[]): Data[] | WideData[] {\r\n    return transformFn && typeof transformFn === 'function' ? transformFn(data) : data;\r\n  };\r\n}\r\n\r\nfunction filterByDate(startDate: string, endDate: string) {\r\n  return function (data: Data[]): Data[] {\r\n    return data\r\n      .map((d) => ({ ...d, date: getDateString(d.date) }))\r\n      .filter((d) => (startDate ? d.date >= startDate : true))\r\n      .filter((d) => (endDate ? d.date <= endDate : true));\r\n  };\r\n}\r\n\r\nfunction processFixedOrder(fixedOrder: string[]) {\r\n  return function (data: Data[]) {\r\n    return fixedOrder.length === 0\r\n      ? data\r\n      : data\r\n          .filter((d) => fixedOrder.includes(d.name))\r\n          .map((d) => ({ ...d, rank: fixedOrder.indexOf(d.name) }));\r\n  };\r\n}\r\n\r\nfunction validateAndSort(data: Data[]): Data[] {\r\n  return data\r\n    .map((d) => {\r\n      const name = d.name ? d.name : '';\r\n      const value = isNaN(+d.value) ? 0 : +d.value;\r\n      return { ...d, name, value };\r\n    })\r\n    .sort((a, b) => a.date.localeCompare(b.date) || a.name.localeCompare(b.name));\r\n}\r\n\r\nfunction fillDateGaps(\r\n  fillDateGapsInterval: Options['fillDateGapsInterval'],\r\n  fillDateGapsValue: Options['fillDateGapsValue'],\r\n  topN: number,\r\n) {\r\n  return function (data: Data[]) {\r\n    return fillDateGapsInterval\r\n      ? fillGaps(data, fillDateGapsInterval, fillDateGapsValue, topN)\r\n      : data;\r\n  };\r\n}\r\n\r\nfunction storeDataCollections(store: Store, changingOptions: boolean) {\r\n  return function (data: Data[]) {\r\n    const names = Array.from(new Set(data.map((d) => String(d.name)))).sort();\r\n    const groups = Array.from(new Set(data.map((d) => String(d.group))))\r\n      .filter(Boolean)\r\n      .sort();\r\n    const dates = getDates(data);\r\n\r\n    store.dispatch(actions.data.dataLoaded({ names, groups, datesCache: dates }));\r\n    if (!changingOptions) {\r\n      store.dispatch(actions.ticker.initialize(dates));\r\n    } else {\r\n      store.dispatch(actions.ticker.changeDates(dates));\r\n    }\r\n    return data;\r\n  };\r\n}\r\n\r\nfunction calculateLastValues(data: Data[]) {\r\n  return data\r\n    .sort((a, b) => a.name.localeCompare(b.name) || a.date.localeCompare(b.date))\r\n    .reduce((acc: Data[], curr) => {\r\n      if (acc.length === 0) {\r\n        curr.lastValue = curr.value;\r\n      } else {\r\n        const last = acc[acc.length - 1];\r\n        if (curr.name === last.name) {\r\n          curr.lastValue = last.value;\r\n        } else {\r\n          curr.lastValue = curr.value;\r\n        }\r\n      }\r\n      return [...acc, curr];\r\n    }, []);\r\n}\r\n\r\nfunction wideDataToLong(dataShape: Options['dataShape'], nested = false) {\r\n  return function (data: WideData[]) {\r\n    if (dataShape === 'long') return data as Data[];\r\n\r\n    const long = [] as Data[];\r\n    data.forEach((row) => {\r\n      for (const [key, value] of Object.entries(row)) {\r\n        if (key === 'date') {\r\n          continue;\r\n        }\r\n\r\n        let item: any = {\r\n          date: row.date,\r\n          name: key,\r\n        };\r\n        if (nested) {\r\n          item = {\r\n            ...item,\r\n            ...value,\r\n          };\r\n        } else {\r\n          item = {\r\n            ...item,\r\n            value,\r\n          };\r\n        }\r\n        long.push(item);\r\n      }\r\n    });\r\n    return long;\r\n  };\r\n}\r\n\r\nfunction longDataToWide(long: Data[]) {\r\n  const wide = [] as WideData[];\r\n  long.forEach((item) => {\r\n    const dateRow = wide.filter((r) => r.date === item.date);\r\n    const row = dateRow.length > 0 ? dateRow[0] : ({} as WideData);\r\n    const { date, ...details } = item;\r\n    row[item.name] = details;\r\n    if (dateRow.length === 0) {\r\n      row.date = item.date;\r\n      wide.push(row);\r\n    }\r\n  });\r\n  return wide;\r\n}\r\n\r\nfunction fillGaps(\r\n  data: Data[],\r\n  interval: Options['fillDateGapsInterval'],\r\n  fillValue: Options['fillDateGapsValue'],\r\n  topN: number,\r\n) {\r\n  if (!interval) {\r\n    return data;\r\n  }\r\n\r\n  const wideData = longDataToWide(data).map((d) => ({ ...d, date: new Date(d.date) }));\r\n\r\n  const allData = wideData\r\n    .reduce(\r\n      (acc: any[], row, i) => {\r\n        const lastDate = acc[acc.length - 1].date;\r\n        const range = getDateRange(lastDate, row.date, interval).slice(1);\r\n\r\n        const rangeStep = 1 / range.length;\r\n        if (i < wideData.length) {\r\n          const iData = interpolateTopN(wideData[i - 1], wideData[i], topN);\r\n          const newData: any[] = [];\r\n          range.forEach((_, j) => {\r\n            const values = fillValue === 'last' ? iData(0) : iData((j + 1) * rangeStep);\r\n            const newRow: any = { date: range[j] };\r\n            for (const [key, value] of Object.entries(values)) {\r\n              if (key !== 'date') {\r\n                newRow[key] = { ...(value as any) };\r\n              }\r\n            }\r\n            newData.push(getDateString(row.date) === getDateString(newRow.date) ? row : newRow);\r\n          });\r\n          return [...acc, ...newData];\r\n        } else {\r\n          return [...acc];\r\n        }\r\n      },\r\n      [wideData[0]],\r\n    )\r\n    .map((d) => ({ ...d, date: getDateString(d.date) }));\r\n\r\n  return wideDataToLong('wide', true)(allData);\r\n}\r\n\r\n/** Interpolate only topN before and after the date range to improve performace */\r\nfunction interpolateTopN(data1: any = {}, data2: any = {}, topN: number) {\r\n  const topData1 = getTopN(data1, topN);\r\n  const topData2 = getTopN(data2, topN);\r\n  const topNames = Array.from(new Set([...topData1, ...topData2]));\r\n\r\n  const filteredData1 = topNames.reduce(\r\n    (acc, curr) => ({ ...acc, [curr]: data1[curr] }),\r\n    {} as WideData,\r\n  );\r\n\r\n  const filteredData2 = topNames.reduce(\r\n    (acc, curr) => ({ ...acc, [curr]: data2[curr] }),\r\n    {} as WideData,\r\n  );\r\n\r\n  return d3.interpolate(filteredData1, filteredData2);\r\n\r\n  function getTopN(data: { [key: string]: { name: string; value: number } } = {}, topN: number) {\r\n    return Object.keys(data)\r\n      .filter((key) => key !== 'date')\r\n      .map((key) => data[key])\r\n      .sort(function (a, b) {\r\n        return b.value - a.value;\r\n      })\r\n      .slice(0, topN)\r\n      .map((d) => d.name);\r\n  }\r\n}\r\n\r\nexport function getDateSlice(date: string, data: Data[], store: Store) {\r\n  let dateSlice: Data[];\r\n  if (store.getState().data.dateSlices[date]) {\r\n    // use cache\r\n    dateSlice = store.getState().data.dateSlices[date];\r\n  } else {\r\n    const slice = data\r\n      .filter((d) => d.date === date && !isNaN(d.value))\r\n      .sort((a, b) => b.value - a.value)\r\n      .map((d, i) => ({ ...d, rank: getRank(d, i, store) }));\r\n\r\n    const emptyData = [{ name: '', value: 0, lastValue: 0, date, rank: 1 }];\r\n    dateSlice = slice.length > 0 ? slice : emptyData;\r\n    // save to cache\r\n    store.dispatch(actions.data.addDateSlice(date, dateSlice));\r\n  }\r\n  const groupFilter = store.getState().data.groupFilter;\r\n  return groupFilter.length > 0 ? filterGroups(dateSlice, store) : dateSlice;\r\n}\r\n\r\nfunction filterGroups(data: Data[], store: Store) {\r\n  const groupFilter = store.getState().data.groupFilter;\r\n  return data\r\n    .filter((d) => (!!d.group ? !groupFilter.includes(d.group) : true))\r\n    .map((d, i) => ({ ...d, rank: getRank(d, i, store) }));\r\n}\r\n\r\nexport function computeNextDateSubscriber(data: Data[], store: Store) {\r\n  return function () {\r\n    if (store.getState().ticker.isRunning) {\r\n      const nextDate = getNextDate(\r\n        store.getState().ticker.dates,\r\n        store.getState().ticker.currentDate,\r\n      );\r\n      getDateSlice(nextDate, data, store);\r\n    }\r\n  };\r\n}\r\n\r\nfunction getRank(d: Data, i: number, store: Store) {\r\n  const fixedOrder = store.getState().options.fixedOrder;\r\n  return fixedOrder.length > 0 ? d.rank : i;\r\n}\r\n","import { getDateString } from '../utils';\r\nimport { Reducer } from '../store';\r\nimport { Options, OptionsAction } from './options.models';\r\nimport { actionTypes } from './options.actions';\r\n\r\nexport const defaultOptions: Options = {\r\n  selector: '#race',\r\n  dataShape: 'long',\r\n  dataTransform: null,\r\n  fillDateGapsInterval: null,\r\n  fillDateGapsValue: 'interpolate',\r\n  startDate: '',\r\n  endDate: '',\r\n  colorSeed: '',\r\n  showGroups: false,\r\n  tickDuration: 500,\r\n  topN: 10,\r\n  mouseControls: false,\r\n  keyboardControls: false,\r\n  autorun: true,\r\n  loop: false,\r\n  injectStyles: true,\r\n  title: '',\r\n  subTitle: '',\r\n  caption: '',\r\n  dateCounter: 'MM/YYYY',\r\n  labelsPosition: 'inside',\r\n  labelsWidth: 150,\r\n  showIcons: false,\r\n  controlButtons: 'all',\r\n  overlays: 'none',\r\n  inputHeight: '',\r\n  inputWidth: '',\r\n  minHeight: 300,\r\n  minWidth: 500,\r\n  height: '',\r\n  width: '',\r\n  marginTop: 0,\r\n  marginRight: 20,\r\n  marginBottom: 5,\r\n  marginLeft: 0,\r\n  theme: 'light',\r\n  colorMap: {},\r\n  fixedScale: false,\r\n  fixedOrder: [],\r\n  highlightBars: false,\r\n  selectBars: false,\r\n};\r\n\r\nexport const optionsReducer: Reducer<Options, OptionsAction> = (state = defaultOptions, action) => {\r\n  switch (action.type) {\r\n    case actionTypes.loadOptions:\r\n    case actionTypes.changeOptions: {\r\n      const excludedKeys = ['inputHeight', 'inputWidth', 'minHeight', 'minWidth'];\r\n      const options: Partial<Options> = {};\r\n\r\n      // remove null, undefined and excluded keys\r\n      (Object.keys(action.payload) as Array<keyof Options>).forEach((key) => {\r\n        if (!excludedKeys.includes(key)) {\r\n          (options[key] as any) = action.payload[key] ?? state[key];\r\n        }\r\n      });\r\n\r\n      const startDate = options.startDate ? getDateString(options.startDate) : state.startDate;\r\n      const endDate = options.endDate ? getDateString(options.endDate) : state.startDate;\r\n\r\n      const inputHeight = options.height || state.inputHeight;\r\n      const inputWidth = options.width || state.inputWidth;\r\n\r\n      const fixedOrder = Array.isArray(options.fixedOrder)\r\n        ? [...options.fixedOrder]\r\n        : state.fixedOrder;\r\n\r\n      const colorMap = Array.isArray(options.colorMap)\r\n        ? [...options.colorMap].map(String)\r\n        : typeof options.colorMap === 'object'\r\n        ? { ...options.colorMap }\r\n        : state.colorMap;\r\n\r\n      const topN = fixedOrder.length || Number(options.topN) || state.topN;\r\n\r\n      const tickDuration = Number(options.tickDuration) || state.tickDuration;\r\n      const labelsWidth = Number(options.labelsWidth) || state.labelsWidth;\r\n      const marginTop = Number(options.marginTop) || state.marginTop;\r\n      const marginRight = Number(options.marginRight) || state.marginRight;\r\n      const marginBottom = Number(options.marginBottom) || state.marginBottom;\r\n      const marginLeft = Number(options.marginLeft) || state.marginLeft;\r\n\r\n      return {\r\n        ...state,\r\n        ...options,\r\n        startDate,\r\n        endDate,\r\n        inputHeight,\r\n        inputWidth,\r\n        fixedOrder,\r\n        colorMap,\r\n        topN,\r\n        tickDuration,\r\n        labelsWidth,\r\n        marginTop,\r\n        marginRight,\r\n        marginBottom,\r\n        marginLeft,\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import * as d3 from '../d3';\n\nimport { Data } from '../data';\nimport { Store } from '../store';\nimport { getHeight, getWidth } from '../utils';\nimport { RenderOptions } from './render-options';\n\nexport function calculateDimensions(store: Store, renderOptions: RenderOptions) {\n  const {\n    minHeight,\n    inputHeight,\n    minWidth,\n    inputWidth,\n    title,\n    subTitle,\n    showGroups,\n    controlButtons,\n    marginTop,\n    marginRight,\n    marginBottom,\n    marginLeft,\n    labelsPosition,\n    labelsWidth,\n    showIcons,\n    fixedOrder,\n  } = store.getState().options;\n  const { root, maxValue } = renderOptions;\n\n  const topN = fixedOrder.length > 0 ? fixedOrder.length : store.getState().options.topN;\n\n  const height = (renderOptions.height = getHeight(root, minHeight, inputHeight));\n  const width = (renderOptions.width = getWidth(root, minWidth, inputWidth));\n\n  const titlePadding = 5;\n  const titleHeight = title ? 55 : 0;\n  const subTitleHeight = !subTitle ? 0 : title ? 20 : 40;\n  const groupsHeight = !showGroups ? 0 : titleHeight || subTitleHeight ? 20 : 30;\n  const controlsHeight = controlButtons !== 'none' ? 50 : 0;\n\n  const headerHeight = Math.max(\n    titleHeight + subTitleHeight + groupsHeight,\n    controlsHeight + groupsHeight,\n    10,\n  );\n\n  const labelsArea = labelsPosition === 'inside' ? 0 : labelsWidth;\n  const topAxisPadding = 15;\n\n  const margin = {\n    top: marginTop + headerHeight + topAxisPadding,\n    right: marginRight,\n    bottom: marginBottom,\n    left: marginLeft + labelsArea,\n  };\n\n  const x = (renderOptions.x = d3\n    .scaleLinear()\n    .domain([0, maxValue])\n    .range([margin.left, width - margin.right - 65]));\n\n  const y = (renderOptions.y = d3\n    .scaleLinear()\n    .domain([topN, 0])\n    .range([height - margin.bottom, margin.top]));\n\n  const barPadding = (renderOptions.barPadding =\n    (height - (margin.bottom + margin.top)) / (topN * 5));\n  const labelPadding = (renderOptions.labelPadding = 8);\n  renderOptions.barWidth = (d: Data) => Math.abs(x(d.value) - x(0) - 1);\n  const barHeight = (renderOptions.barHeight = y(1) - y(0) - barPadding);\n  renderOptions.barHalfHeight = (y(1) - y(0)) / 2 + 1;\n  renderOptions.barY = (d: Data) => y(d.rank as number) + 5;\n  const iconSize = (renderOptions.iconSize = showIcons ? barHeight * 0.9 : 0);\n  const iconSpace = (renderOptions.iconSpace = showIcons ? iconSize + labelPadding : 0);\n  renderOptions.labelX =\n    labelsPosition === 'inside'\n      ? (d: Data) => x(d.value) - labelPadding - iconSpace\n      : margin.left - labelPadding;\n\n  renderOptions.titlePadding = titlePadding;\n  renderOptions.titleHeight = titleHeight;\n  renderOptions.margin = margin;\n}\n","import * as d3 from '../d3';\r\n\r\nimport { Data } from '../data';\r\nimport { Store, actions } from '../store';\r\nimport { safeName, toggleClass, getClicks } from '../utils';\r\nimport { RenderOptions } from './render-options';\r\n\r\nexport function halo(text: any, renderOptions: RenderOptions) {\r\n  renderOptions.svg //\r\n    .selectAll('.halo')\r\n    .remove();\r\n\r\n  text\r\n    .select(function () {\r\n      return this.parentNode.insertBefore(this.cloneNode(true), this);\r\n    })\r\n    .classed('halo', true);\r\n}\r\n\r\nexport function legendClick(d: string, store: Store) {\r\n  getClicks(d3.event, function (event: any) {\r\n    const clicks = event.detail;\r\n    if (clicks === 3) {\r\n      store.dispatch(actions.data.resetFilters());\r\n    } else if (clicks === 2) {\r\n      store.dispatch(actions.data.allExceptFilter(d));\r\n    } else {\r\n      store.dispatch(actions.data.toggleFilter(d));\r\n    }\r\n  });\r\n}\r\n\r\nexport function highlightFn(d: Data, store: Store, renderOptions: RenderOptions) {\r\n  if (store.getState().options.highlightBars) {\r\n    toggleClass(renderOptions.root, 'rect.' + safeName(d.name), 'highlight');\r\n  }\r\n}\r\n\r\nexport function selectFn(d: Data, store: Store, renderOptions: RenderOptions) {\r\n  if (store.getState().options.selectBars) {\r\n    toggleClass(renderOptions.root, 'rect.' + safeName(d.name), 'selected');\r\n    store.dispatch(actions.data.toggleSelection(d.name));\r\n  }\r\n}\r\n","import * as d3 from '../d3';\n\nimport { Data } from '../data';\nimport { Store } from '../store';\nimport { getText, getColor } from '../utils';\nimport { RenderOptions } from './render-options';\nimport { legendClick } from './helpers';\n\nexport function renderHeader(\n  store: Store,\n  renderOptions: RenderOptions,\n  CompleteDateSlice: Data[],\n) {\n  const groups = store.getState().data.groups;\n  const dates = store.getState().ticker.dates;\n  const currentDate = store.getState().ticker.currentDate;\n  const { title, subTitle, marginTop, marginLeft, showGroups } = store.getState().options;\n  const { svg, margin, width, titlePadding, titleHeight } = renderOptions;\n\n  renderOptions.titleText = svg\n    .append('text')\n    .attr('class', 'title')\n    .attr('x', marginLeft + titlePadding)\n    .attr('y', marginTop + 24)\n    .html(getText(title, currentDate, CompleteDateSlice, dates));\n\n  renderOptions.subTitleText = svg\n    .append('text')\n    .attr('class', 'subTitle')\n    .attr('x', marginLeft + titlePadding)\n    .attr('y', marginTop + (titleHeight || 24))\n    .html(getText(subTitle, currentDate, CompleteDateSlice, dates));\n\n  if (showGroups) {\n    const legendsWrapper = svg.append('g');\n    const legends = legendsWrapper\n      .selectAll('.legend-wrapper')\n      .data(groups)\n      .enter()\n      .append('g')\n      .attr('class', 'legend legend-wrapper')\n      .style('cursor', 'pointer')\n      .style('opacity', (d: string) => (store.getState().data.groupFilter.includes(d) ? 0.3 : 1))\n      .on('click', (d: string) => legendClick(d, store));\n\n    legends\n      .append('rect')\n      .attr('class', 'legend legend-color')\n      .attr('width', 10)\n      .attr('height', 10)\n      .attr('y', margin.top - 35)\n      .style('fill', (d: string) => getColor({ group: d } as Data, store) as string);\n\n    legends\n      .append('text')\n      .attr('class', 'legend legend-text')\n      .attr('x', 20)\n      .attr('y', margin.top - 25)\n      .html((d: string) => d);\n\n    let legendX = margin.left + titlePadding;\n    let legendY = 0;\n    legends.each(function () {\n      const wrapper = d3.select(this);\n      const text = wrapper.select('text') as any;\n      const bbox = text.node().getBBox();\n      if (legendX + bbox.width > width) {\n        legendX = margin.left + titlePadding;\n        legendY += 30;\n      }\n      wrapper.attr('transform', 'translate(' + legendX + ', ' + legendY + ')');\n      legendX += bbox.width + 40;\n    });\n\n    margin.top += legendY;\n  }\n}\n","export const elements = {\r\n  controls: 'controls',\r\n  skipBack: 'skipBack',\r\n  play: 'play',\r\n  pause: 'pause',\r\n  skipForward: 'skipForward',\r\n  overlay: 'overlay',\r\n  overlayPlay: 'overlayPlay',\r\n  overlayRepeat: 'overlayRepeat',\r\n};\r\n","export const buttons = {\r\n  skipBack: `<svg viewBox=\"0 0 32 32\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" fill=\"none\" stroke=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\"><g><path d=\"M28.46,4a3,3,0,0,0-3,.07l-15.2,9.41A3,3,0,0,0,9,15V5A3,3,0,0,0,6,2H5A3,3,0,0,0,2,5V27a3,3,0,0,0,3,3H6a3,3,0,0,0,3-3V17a3,3,0,0,0,1.22,1.53L25.42,28a3,3,0,0,0,1.58.46,3,3,0,0,0,3-3V6.59A3,3,0,0,0,28.46,4Z\"/></g></svg>`,\r\n  play: `<svg viewBox=\"0 0 32 32\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" fill=\"none\" stroke=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\"><g><path d=\"M26.78,13.45,11.58,4A3,3,0,0,0,7,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,11.58,28l15.2-9.41a3,3,0,0,0,0-5.1Z\"/></g></svg>`,\r\n  pause: `<svg viewBox=\"0 0 32 32\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" fill=\"none\" stroke=\"currentColor\" xmlns:svg=\"http://www.w3.org/2000/svg\"><g transform=\"translate(-17)\"><path d=\"m 27,2 h -1 c -1.656854,0 -3,1.3431458 -3,3 v 12 c -0.04755,3.269656 0,6.666667 0,10 0,1.656854 1.343146,3 3,3 h 1 c 1.656854,0 3,-1.343146 3,-3 V 5 C 30,3.3431458 28.656854,2 27,2 Z\" /></g><g transform=\"translate(-4)\"><path d=\"m 27,2 h -1 c -1.656854,0 -3,1.3431458 -3,3 v 12 c -0.04755,3.269656 0,6.666667 0,10 0,1.656854 1.343146,3 3,3 h 1 c 1.656854,0 3,-1.343146 3,-3 V 5 C 30,3.3431458 28.656854,2 27,2 Z\" /></g></svg>`,\r\n  skipForward: `<svg viewBox=\"0 0 32 32\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" fill=\"none\" stroke=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\"><g><path d=\"M27,2H26a3,3,0,0,0-3,3V15a3,3,0,0,0-1.22-1.53L6.58,4A3,3,0,0,0,2,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,6.58,28l15.2-9.41A3,3,0,0,0,23,17V27a3,3,0,0,0,3,3h1a3,3,0,0,0,3-3V5A3,3,0,0,0,27,2Z\"/></g></svg>`,\r\n  overlayPlay: `<svg viewBox=\"0 0 32 32\" fill=\"currentColor\" stroke=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\"><g><path d=\"M26.78,13.45,11.58,4A3,3,0,0,0,7,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,11.58,28l15.2-9.41a3,3,0,0,0,0-5.1Z\"/></g></svg>`,\r\n  overlayRepeat: `<svg viewBox=\"0 0 32 32\" fill=\"currentColor\" stroke=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\"><g><path d=\"M18,4A12,12,0,0,0,6.05,15H3a1,1,0,0,0-.88.53,1,1,0,0,0,0,1l4,6a1,1,0,0,0,1.66,0l4-6a1,1,0,0,0,.05-1A1,1,0,0,0,11,15H8.05A10,10,0,1,1,18,26a1,1,0,0,0,0,2A12,12,0,0,0,18,4Z\"/></g></svg>`,\r\n};\r\n","import * as d3 from '../d3';\n\nimport { Store } from '../store';\nimport { hideElement, showElement } from '../utils';\nimport { elements } from './elements';\nimport { buttons } from './buttons';\nimport { RenderOptions } from './render-options';\n\nexport function renderControls(store: Store, renderOptions: RenderOptions) {\n  const { marginTop, controlButtons } = store.getState().options;\n  const { root, width, margin, barPadding } = renderOptions;\n\n  const elementWidth = root.getBoundingClientRect().width;\n  const controlButtonIcons = [\n    { skipBack: buttons.skipBack },\n    { play: buttons.play },\n    { pause: buttons.pause },\n    { skipForward: buttons.skipForward },\n  ];\n\n  d3.select(root)\n    .append('div')\n    .classed('controls', true)\n    .style('position', 'absolute')\n    .style('top', marginTop + 'px')\n    .style('right', elementWidth - width + margin.right + barPadding + 'px')\n    .selectAll('div')\n    .data(controlButtonIcons)\n    .enter()\n    .append('div')\n    .html((d) => Object.values(d)[0] as string)\n    .attr('class', (d) => Object.keys(d)[0]);\n\n  if (controlButtons === 'play') {\n    hideElement(root, elements.skipBack);\n    hideElement(root, elements.skipForward);\n  }\n  if (controlButtons === 'none') {\n    hideElement(root, elements.controls);\n  }\n}\n\nexport function updateControls(store: Store, renderOptions: RenderOptions) {\n  const { overlays, loop } = store.getState().options;\n  const { root } = renderOptions;\n\n  if (store.getState().ticker.isRunning) {\n    showElement(root, elements.pause);\n    hideElement(root, elements.play);\n  } else {\n    showElement(root, elements.play);\n    hideElement(root, elements.pause);\n  }\n\n  if (\n    store.getState().ticker.isFirstDate &&\n    (overlays === 'all' || overlays === 'play') &&\n    !store.getState().ticker.isRunning\n  ) {\n    hideElement(root, elements.controls, true);\n    showElement(root, elements.overlay);\n    showElement(root, elements.overlayPlay);\n    hideElement(root, elements.overlayRepeat);\n  } else if (\n    store.getState().ticker.isLastDate &&\n    (overlays === 'all' || overlays === 'repeat') &&\n    !(loop && store.getState().ticker.isRunning)\n  ) {\n    hideElement(root, elements.controls, true);\n    showElement(root, elements.overlay);\n    showElement(root, elements.overlayRepeat);\n    hideElement(root, elements.overlayPlay);\n  } else {\n    showElement(root, elements.controls, true);\n    hideElement(root, elements.overlay);\n  }\n}\n\nexport function renderOverlays(store: Store, renderOptions: RenderOptions) {\n  const { minHeight, minWidth } = store.getState().options;\n  const { root } = renderOptions;\n\n  const overlayButtonIcons = [\n    { overlayPlay: buttons.overlayPlay },\n    { overlayRepeat: buttons.overlayRepeat },\n  ];\n\n  d3.select(root)\n    .append('div')\n    .classed('overlay', true)\n    .style('minHeight', minHeight + 'px')\n    .style('minWidth', minWidth + 'px')\n    .selectAll('div')\n    .data(overlayButtonIcons)\n    .enter()\n    .append('div')\n    .html((d) => Object.values(d)[0] as string)\n    .attr('class', (d) => Object.keys(d)[0]);\n}\n","import * as d3 from '../d3';\r\n\r\nimport { Store } from '../store';\r\nimport { Data } from '../data';\r\nimport { getDateSlice, getText, getColor, safeName, getIconID } from '../utils';\r\nimport { RenderOptions } from './render-options';\r\nimport { calculateDimensions } from './calculate-dimensions';\r\nimport { renderHeader } from './render-header';\r\nimport { renderControls, renderOverlays, updateControls } from './controls';\r\nimport { selectFn, highlightFn, halo } from './helpers';\r\n\r\nexport function renderInitalView(data: Data[], store: Store, renderOptions: RenderOptions) {\r\n  const {\r\n    selector,\r\n    caption,\r\n    dateCounter,\r\n    labelsPosition,\r\n    showIcons,\r\n    fixedScale,\r\n    fixedOrder,\r\n  } = store.getState().options;\r\n\r\n  const dates = store.getState().ticker.dates;\r\n  const root = (renderOptions.root = document.querySelector(selector) as HTMLElement);\r\n  const topN = fixedOrder.length > 0 ? fixedOrder.length : store.getState().options.topN;\r\n  const currentDate = store.getState().ticker.currentDate;\r\n  const CompleteDateSlice = getDateSlice(currentDate, data, store);\r\n  const dateSlice = CompleteDateSlice.slice(0, topN);\r\n  const lastDateIndex = dates.indexOf(currentDate) > 0 ? dates.indexOf(currentDate) - 1 : 0;\r\n  renderOptions.lastDate = dates[lastDateIndex];\r\n\r\n  if (!root || dateSlice.length === 0) return;\r\n\r\n  root.innerHTML = '';\r\n\r\n  renderInitialFrame();\r\n  renderControls(store, renderOptions);\r\n  renderOverlays(store, renderOptions);\r\n  updateControls(store, renderOptions);\r\n\r\n  function renderInitialFrame() {\r\n    renderOptions.maxValue = fixedScale\r\n      ? data.map((d) => d.value).reduce((max, val) => (max > val ? max : val), 0)\r\n      : (d3.max(dateSlice, (d: Data) => d.value) as number);\r\n\r\n    calculateDimensions(store, renderOptions);\r\n\r\n    const {\r\n      margin,\r\n      width,\r\n      height,\r\n      x,\r\n      y,\r\n      barWidth,\r\n      barHeight,\r\n      barY,\r\n      barHalfHeight,\r\n      labelX,\r\n      iconSize,\r\n      labelPadding,\r\n    } = renderOptions;\r\n\r\n    const svg: any = (renderOptions.svg = d3\r\n      .select(root)\r\n      .append('svg')\r\n      .attr('width', width)\r\n      .attr('height', height));\r\n\r\n    renderHeader(store, renderOptions, CompleteDateSlice);\r\n\r\n    const xAxis = (renderOptions.xAxis = d3\r\n      .axisTop(x)\r\n      .ticks(width > 500 ? 5 : 2)\r\n      .tickSize(-(height - (margin.top + margin.bottom)))\r\n      .tickFormat((n: number | { valueOf(): number }) => d3.format(',')(n)));\r\n\r\n    svg\r\n      .append('g')\r\n      .attr('class', 'axis xAxis')\r\n      .attr('transform', `translate(0, ${margin.top})`)\r\n      .call(xAxis)\r\n      .selectAll('.tick line')\r\n      .classed('origin', (d: unknown) => d === 0);\r\n\r\n    svg\r\n      .selectAll('rect.bar')\r\n      .data(dateSlice, (d: Data) => d.name)\r\n      .enter()\r\n      .append('rect')\r\n      .attr('class', (d: Data) => 'bar ' + safeName(d.name))\r\n      .classed('selected', (d: Data) => store.getState().data.selected.includes(d.name))\r\n      .attr('x', x(0) + 1)\r\n      .attr('width', barWidth)\r\n      .attr('y', barY)\r\n      .attr('height', barHeight)\r\n      .style('fill', (d: Data) => getColor(d, store))\r\n      .on('click', (d: Data) => selectFn(d, store, renderOptions))\r\n      .on('mouseover', (d: Data) => highlightFn(d, store, renderOptions))\r\n      .on('mouseout', (d: Data) => highlightFn(d, store, renderOptions));\r\n\r\n    svg\r\n      .selectAll('text.label')\r\n      .data(dateSlice, (d: Data) => d.name)\r\n      .enter()\r\n      .append('text')\r\n      .attr('class', 'label')\r\n      .classed('outside-bars', labelsPosition !== 'inside')\r\n      .attr('x', labelX)\r\n      .attr('y', (d: Data) => barY(d) + barHalfHeight)\r\n      .style('text-anchor', 'end')\r\n      .html((d: Data) => d.name)\r\n      .on('click', (d: Data) => selectFn(d, store, renderOptions))\r\n      .on('mouseover', (d: Data) => highlightFn(d, store, renderOptions))\r\n      .on('mouseout', (d: Data) => highlightFn(d, store, renderOptions));\r\n\r\n    svg\r\n      .selectAll('text.valueLabel')\r\n      .data(dateSlice, (d: Data) => d.name)\r\n      .enter()\r\n      .append('text')\r\n      .attr('class', 'valueLabel')\r\n      .attr('x', (d: Data) => x(d.value) + 5)\r\n      .attr('y', (d: Data) => barY(d) + barHalfHeight)\r\n      .text((d: Data) => d3.format(',.0f')(d.lastValue as number));\r\n\r\n    if (showIcons) {\r\n      const defs = (renderOptions.defs = svg.append('svg:defs'));\r\n\r\n      defs\r\n        .selectAll('svg')\r\n        .data(dateSlice, (d: Data) => d.name)\r\n        .enter()\r\n        .append('svg:pattern')\r\n        .attr('class', 'svgpattern')\r\n        .attr('id', getIconID)\r\n        .attr('width', iconSize)\r\n        .attr('height', iconSize)\r\n        .append('svg:image')\r\n        .attr('xlink:href', (d: Data) => d.icon)\r\n        .attr('width', iconSize)\r\n        .attr('height', iconSize)\r\n        .attr('x', 0)\r\n        .attr('y', 0);\r\n\r\n      svg\r\n        .selectAll('circle')\r\n        .data(dateSlice, (d: Data) => d.name)\r\n        .enter()\r\n        .append('circle')\r\n        .attr('cx', (d: Data) => x(d.value) - iconSize / 2 - labelPadding)\r\n        .attr('cy', (d: Data) => y(d.rank as number) + barHalfHeight)\r\n        .attr('r', iconSize / 2)\r\n        .style('fill', 'transparent')\r\n        .style('fill', (d: Data) => `url(#${getIconID(d)})`);\r\n    }\r\n\r\n    const endY = height - margin.bottom;\r\n    const endX = width - margin.right;\r\n    const dateCounterTextY = caption ? endY - 30 : endY - 5;\r\n    renderOptions.dateCounterText = svg\r\n      .append('text')\r\n      .attr('class', 'dateCounterText')\r\n      .attr('x', endX)\r\n      .attr('y', dateCounterTextY)\r\n      .style('text-anchor', 'end')\r\n      .html(getText(dateCounter, currentDate, CompleteDateSlice, dates, true))\r\n      .call((text: any) => halo(text, renderOptions));\r\n\r\n    renderOptions.captionText = svg\r\n      .append('text')\r\n      .attr('class', 'caption')\r\n      .attr('x', endX - 10)\r\n      .attr('y', endY - 5)\r\n      .style('text-anchor', 'end')\r\n      .html(getText(caption, currentDate, CompleteDateSlice, dates));\r\n  }\r\n}\r\n","import * as d3 from '../d3';\r\n\r\nimport { Data } from '../data';\r\nimport { Store } from '../store';\r\nimport { getDateSlice, safeName, getColor, getIconID, getText } from '../utils';\r\nimport { RenderOptions } from './render-options';\r\nimport { selectFn, highlightFn, halo } from './helpers';\r\nimport { updateControls } from './controls';\r\n\r\nexport function renderFrame(data: Data[], store: Store, renderOptions: RenderOptions) {\r\n  const {\r\n    svg,\r\n    titleText,\r\n    subTitleText,\r\n    dateCounterText,\r\n    captionText,\r\n    x,\r\n    y,\r\n    xAxis,\r\n    labelPadding,\r\n    barWidth,\r\n    barHeight,\r\n    barHalfHeight,\r\n    barY,\r\n    iconSize,\r\n    labelX,\r\n    defs,\r\n    lastDate,\r\n  } = renderOptions;\r\n  const dates = store.getState().ticker.dates;\r\n  const { showGroups } = store.getState().options;\r\n\r\n  if (!x) {\r\n    return;\r\n  }\r\n\r\n  const {\r\n    tickDuration,\r\n    title,\r\n    subTitle,\r\n    caption,\r\n    dateCounter,\r\n    marginBottom,\r\n    fixedScale,\r\n    fixedOrder,\r\n    labelsPosition,\r\n  } = store.getState().options;\r\n\r\n  const topN = fixedOrder.length > 0 ? fixedOrder.length : store.getState().options.topN;\r\n  const currentDate = store.getState().ticker.currentDate;\r\n  const CompleteDateSlice = getDateSlice(currentDate, data, store);\r\n  const dateSlice = CompleteDateSlice.slice(0, topN);\r\n\r\n  if (showGroups) {\r\n    svg\r\n      .selectAll('.legend-wrapper')\r\n      .style('opacity', (d: string) => (store.getState().data.groupFilter.includes(d) ? 0.3 : 1));\r\n  }\r\n\r\n  if (!fixedScale) {\r\n    x.domain([0, d3.max(dateSlice, (d: Data) => d.value) as number]);\r\n\r\n    svg //\r\n      .select('.xAxis')\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .call(xAxis);\r\n  }\r\n\r\n  const bars = svg //\r\n    .selectAll('.bar')\r\n    .data(dateSlice, (d: Data) => d.name);\r\n\r\n  bars\r\n    .enter()\r\n    .append('rect')\r\n    .attr('class', (d: Data) => 'bar ' + safeName(d.name))\r\n    .classed('selected', (d: Data) => store.getState().data.selected.includes(d.name))\r\n    .attr('x', x(0) + 1)\r\n    .attr('width', barWidth)\r\n    .attr('y', () => y(topN + 1) + marginBottom + 5)\r\n    .attr('height', barHeight)\r\n    .style('fill', (d: Data) => getColor(d, store))\r\n    .on('click', (d: Data) => selectFn(d, store, renderOptions))\r\n    .on('mouseover', (d: Data) => highlightFn(d, store, renderOptions))\r\n    .on('mouseout', (d: Data) => highlightFn(d, store, renderOptions))\r\n    .transition()\r\n    .duration(tickDuration)\r\n    .ease(d3.easeLinear)\r\n    .attr('y', barY);\r\n\r\n  bars\r\n    .transition()\r\n    .duration(tickDuration)\r\n    .ease(d3.easeLinear)\r\n    .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\r\n    .attr('y', barY);\r\n\r\n  bars\r\n    .exit()\r\n    .transition()\r\n    .duration(tickDuration)\r\n    .ease(d3.easeLinear)\r\n    .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\r\n    .attr('y', () => y(topN + 1) + marginBottom + 5)\r\n    .remove();\r\n\r\n  const labels = svg //\r\n    .selectAll('.label')\r\n    .data(dateSlice, (d: Data) => d.name);\r\n\r\n  labels\r\n    .enter()\r\n    .append('text')\r\n    .attr('class', 'label')\r\n    .classed('outside-bars', labelsPosition !== 'inside')\r\n    .attr('x', labelX)\r\n    .attr('y', () => y(topN + 1) + marginBottom + 5 + barHalfHeight)\r\n    .style('text-anchor', 'end')\r\n    .html((d: Data) => d.name)\r\n    .on('click', (d: Data) => selectFn(d, store, renderOptions))\r\n    .on('mouseover', (d: Data) => highlightFn(d, store, renderOptions))\r\n    .on('mouseout', (d: Data) => highlightFn(d, store, renderOptions))\r\n    .transition()\r\n    .duration(tickDuration)\r\n    .ease(d3.easeLinear)\r\n    .attr('y', (d: Data) => barY(d) + barHalfHeight);\r\n\r\n  labels\r\n    .transition()\r\n    .duration(tickDuration)\r\n    .ease(d3.easeLinear)\r\n    .attr('x', labelX)\r\n    .attr('y', (d: Data) => barY(d) + barHalfHeight);\r\n\r\n  labels\r\n    .exit()\r\n    .transition()\r\n    .duration(tickDuration)\r\n    .ease(d3.easeLinear)\r\n    .attr('x', labelX)\r\n    .attr('y', () => y(topN + 1) + marginBottom + 5)\r\n    .remove();\r\n\r\n  const valueLabels = svg //\r\n    .selectAll('.valueLabel')\r\n    .data(dateSlice, (d: Data) => d.name);\r\n\r\n  valueLabels\r\n    .enter()\r\n    .append('text')\r\n    .attr('class', 'valueLabel')\r\n    .attr('x', (d: Data) => x(d.value) + 5)\r\n    .attr('y', () => y(topN + 1) + marginBottom + 5)\r\n    .text((d: Data) => d3.format(',.0f')(d.lastValue as number))\r\n    .transition()\r\n    .duration(tickDuration)\r\n    .ease(d3.easeLinear)\r\n    .attr('y', (d: Data) => barY(d) + barHalfHeight);\r\n\r\n  const sameDate = lastDate === currentDate;\r\n  valueLabels\r\n    .transition()\r\n    .duration(tickDuration)\r\n    .ease(d3.easeLinear)\r\n    .attr('x', (d: Data) => x(d.value) + 5)\r\n    .attr('y', (d: Data) => barY(d) + barHalfHeight)\r\n    .tween('text', function (d: Data) {\r\n      const lastValue = sameDate ? d.value : (d.lastValue as number);\r\n      const i = d3.interpolateRound(lastValue, d.value);\r\n      return function (t: number) {\r\n        this.textContent = d3.format(',')(i(t));\r\n      };\r\n    });\r\n\r\n  valueLabels\r\n    .exit()\r\n    .transition()\r\n    .duration(tickDuration)\r\n    .ease(d3.easeLinear)\r\n    .attr('x', (d: Data) => x(d.value) + 5)\r\n    .attr('y', () => y(topN + 1) + marginBottom + 5)\r\n    .remove();\r\n\r\n  if (store.getState().options.showIcons) {\r\n    const iconPatterns = defs.selectAll('.svgpattern').data(dateSlice, (d: Data) => d.name);\r\n\r\n    iconPatterns\r\n      .enter()\r\n      .append('svg:pattern')\r\n      .attr('class', 'svgpattern')\r\n      .attr('id', getIconID)\r\n      .attr('width', iconSize)\r\n      .attr('height', iconSize)\r\n      .append('svg:image')\r\n      .attr('xlink:href', (d: Data) => d.icon)\r\n      .attr('width', iconSize)\r\n      .attr('height', iconSize)\r\n      .style('z-index', '99')\r\n      .attr('x', 0)\r\n      .attr('y', 0);\r\n\r\n    iconPatterns //\r\n      .exit()\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .remove();\r\n\r\n    const icons = svg //\r\n      .selectAll('circle')\r\n      .data(dateSlice, (d: Data) => d.name);\r\n\r\n    icons\r\n      .enter()\r\n      .append('circle')\r\n      .attr('cx', (d: Data) => x(d.value) - iconSize / 2 - labelPadding)\r\n      .attr('cy', () => y(topN + 1) + iconSize + barHalfHeight)\r\n      .attr('r', iconSize / 2)\r\n      .style('z-index', '99')\r\n      .style('fill', 'transparent')\r\n      .style('fill', (d: Data) => `url(#${getIconID(d)})`)\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('cy', (d: Data) => y(d.rank as number) + barHalfHeight);\r\n\r\n    icons\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('cx', (d: Data) => x(d.value) - iconSize / 2 - labelPadding)\r\n      .attr('cy', (d: Data) => y(d.rank as number) + barHalfHeight);\r\n\r\n    icons\r\n      .exit()\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('cx', (d: Data) => x(d.value) - iconSize / 2 - labelPadding)\r\n      .attr('cy', () => y(topN + 1) + iconSize + barHalfHeight)\r\n      .remove();\r\n  }\r\n\r\n  titleText.html(getText(title, currentDate, CompleteDateSlice, dates));\r\n  subTitleText.html(getText(subTitle, currentDate, CompleteDateSlice, dates));\r\n  captionText.html(getText(caption, currentDate, CompleteDateSlice, dates));\r\n  dateCounterText\r\n    .html(getText(dateCounter, currentDate, CompleteDateSlice, dates, true))\r\n    .call((text: any) => halo(text, renderOptions));\r\n\r\n  updateControls(store, renderOptions);\r\n\r\n  renderOptions.lastDate = currentDate;\r\n}\r\n","import { Data } from '../data';\r\nimport { Store } from '../store';\r\nimport { getHeight, getWidth } from '../utils';\r\nimport { RenderOptions } from './render-options';\r\nimport { renderInitalView } from './render-initial-view';\r\nimport { renderFrame } from './render-frame';\r\nimport { updateControls } from './controls';\r\n\r\nexport function resize(data: Data[], store: Store, renderOptions: RenderOptions) {\r\n  const { inputHeight, inputWidth, minHeight, minWidth } = store.getState().options;\r\n  const { root } = renderOptions;\r\n\r\n  if (!root) return;\r\n\r\n  if (\r\n    (!inputHeight && !inputWidth) ||\r\n    String(inputHeight).startsWith('window') ||\r\n    String(inputWidth).startsWith('window')\r\n  ) {\r\n    renderOptions.height = getHeight(root, minHeight, inputHeight);\r\n    renderOptions.width = getWidth(root, minWidth, inputWidth);\r\n\r\n    const currentPosition = root.style.position; // \"fixed\" if scrolling\r\n\r\n    renderInitalView(data, store, renderOptions);\r\n    renderFrame(data, store, renderOptions);\r\n    renderFrame(data, store, renderOptions); // workaround to avoid showing lastValue\r\n    updateControls(store, renderOptions);\r\n\r\n    root.style.position = currentPosition;\r\n  }\r\n}\r\n","import { Data } from '../data';\r\nimport { Store } from '../store';\r\nimport { Renderer } from './renderer.models';\r\nimport { renderInitalView } from './render-initial-view';\r\nimport { renderFrame } from './render-frame';\r\nimport { resize } from './resize';\r\nimport { RenderOptions } from './render-options';\r\n\r\nexport function createRenderer(data: Data[], store: Store): Renderer {\r\n  const renderOptions = {} as RenderOptions;\r\n\r\n  return {\r\n    renderInitalView: () => renderInitalView(data, store, renderOptions),\r\n    renderFrame: () => renderFrame(data, store, renderOptions),\r\n    resize: () => resize(data, store, renderOptions),\r\n  };\r\n}\r\n","import { Store } from '../store';\r\nimport { Renderer } from './renderer.models';\r\n\r\nexport function rendererSubscriber(store: Store, renderer: Renderer) {\r\n  return function () {\r\n    if (store.getState().triggerRender) {\r\n      renderer.renderFrame();\r\n    }\r\n  };\r\n}\r\n","// This file is auto-generated and will be over-written!\n// Please do NOT edit this file directly\n// You may edit files in this folder instead: src\\lib\\css\n\nexport const styles = `\n__selector__ text {\n  font-size: 16px;\n  font-family: Open Sans, sans-serif;\n}\n\n__selector__ text.title {\n  font-size: 24px;\n  font-weight: 500;\n}\n\n__selector__ text.subTitle {\n  font-weight: 500;\n}\n\n__selector__ text.caption {\n  font-weight: 400;\n  font-size: 24px;\n}\n__selector__ text.legend-text {\n  user-select: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n}\n__selector__ text.label {\n  font-weight: 600;\n}\n\n__selector__ text.valueLabel {\n  font-weight: 300;\n}\n\n__selector__ text.dateCounterText {\n  font-size: 64px;\n  font-weight: 700;\n}\n\n__selector__ .xAxis .tick:nth-child(2) text {\n  text-anchor: start;\n}\n\n__selector__ .tick line {\n  shape-rendering: CrispEdges;\n}\n\n__selector__ path.domain {\n  display: none;\n}\n\n__selector__ {\n  position: relative;\n}\n\n__selector__ .controls {\n  /*  position is set dynamically in renderer.ts */\n  display: flex;\n}\n\n__selector__ .controls div,\n__selector__ .overlay div {\n  cursor: pointer;\n  font-size: 24px;\n  font-weight: 700;\n  width: 38px;\n  height: 38px;\n  -moz-border-radius: 5px;\n  -webkit-border-radius: 5px;\n  border-radius: 5px;\n  margin: 5px;\n  text-align: center;\n}\n\n__selector__ .controls svg {\n  margin: 5px auto;\n  width: 28px;\n  height: 28px;\n}\n\n__selector__ .overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n__selector__ .overlay div {\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 200px;\n  height: 200px;\n  -moz-border-radius: 100px;\n  -webkit-border-radius: 100px;\n  border-radius: 100px;\n}\n__selector__ .overlay svg {\n  height: 50%;\n  width: 50%;\n}\n`;\n\nexport const themes = {\n\"dark\": `\n__selector__ {\r\n  background-color: #313639;\r\n}\r\n\r\n__selector__ text.title {\r\n  fill: #fafafa;\r\n}\r\n\r\n__selector__ text.subTitle {\r\n  fill: #cccccc;\r\n}\r\n\r\n__selector__ text.dateCounterText {\r\n  fill: #cccccc;\r\n  opacity: 1;\r\n}\r\n\r\n__selector__ text.caption {\r\n  fill: #cccccc;\r\n}\r\n\r\n__selector__ .halo {\r\n  fill: #313639;\r\n  stroke: #313639;\r\n  stroke-width: 10;\r\n  stroke-linejoin: round;\r\n  opacity: 1;\r\n}\r\n\r\n__selector__ text.legend-text {\r\n  fill: #fafafa;\r\n}\r\n\r\n__selector__ text.label {\r\n  fill: #313639;\r\n}\r\n\r\n__selector__ text.label.outside-bars {\r\n  fill: #fafafa;\r\n}\r\n\r\n__selector__ text.valueLabel {\r\n  fill: #fafafa;\r\n}\r\n\r\n__selector__ .tick text {\r\n  fill: #cccccc;\r\n}\r\n\r\n__selector__ .tick line {\r\n  shape-rendering: CrispEdges;\r\n  stroke: #dddddd;\r\n}\r\n\r\n__selector__ .tick line.origin {\r\n  stroke: #aaaaaa;\r\n}\r\n\r\n__selector__ .controls div,\r\n__selector__ .overlay div {\r\n  color: #ffffff;\r\n  background: #777777;\r\n  border: 1px solid black;\r\n  opacity: 0.5;\r\n}\r\n\r\n__selector__ .controls div:hover,\r\n__selector__ .overlay div:hover {\r\n  background: #aaaaaa;\r\n  color: black;\r\n}\r\n\r\n__selector__ .overlay {\r\n  background-color: black;\r\n  opacity: 0.7;\r\n}\r\n\r\n__selector__ .highlight {\r\n  fill: #ff2727 !important;\r\n}\r\n\r\n__selector__ .selected {\r\n  fill: #d12020 !important;\r\n  stroke: #777777 !important;\r\n  stroke-width: 1 !important;\r\n}\r\n`,\n\"light\": `\n/* __selector__ {\r\n  background-color: #ffffff;\r\n}\r\n\r\n__selector__ text.title {\r\n  fill: #fafafa;\r\n} */\r\n\r\n__selector__ text.subTitle {\r\n  fill: #777777;\r\n}\r\n\r\n__selector__ text.dateCounterText {\r\n  fill: #bbbbbb;\r\n  opacity: 1;\r\n}\r\n\r\n__selector__ text.caption {\r\n  fill: #777777;\r\n}\r\n\r\n__selector__ .halo {\r\n  fill: #ffffff;\r\n  stroke: #ffffff;\r\n  stroke-width: 10;\r\n  stroke-linejoin: round;\r\n  opacity: 1;\r\n}\r\n\r\n__selector__ text.legend-text {\r\n  fill: #000000;\r\n}\r\n\r\n__selector__ text.label {\r\n  fill: #000000;\r\n}\r\n\r\n__selector__ text.label.outside-bars {\r\n  fill: #000000;\r\n}\r\n\r\n__selector__ text.valueLabel {\r\n  fill: #000000;\r\n}\r\n\r\n__selector__ .tick text {\r\n  fill: #777777;\r\n}\r\n\r\n__selector__ .tick line {\r\n  shape-rendering: CrispEdges;\r\n  stroke: #dddddd;\r\n}\r\n\r\n__selector__ .tick line.origin {\r\n  stroke: #aaaaaa;\r\n}\r\n\r\n__selector__ .controls div,\r\n__selector__ .overlay div {\r\n  color: #ffffff;\r\n  background: #777777;\r\n  border: 1px solid black;\r\n  opacity: 0.5;\r\n}\r\n\r\n__selector__ .controls div:hover,\r\n__selector__ .overlay div:hover {\r\n  background: #aaaaaa;\r\n  color: black;\r\n}\r\n\r\n__selector__ .overlay {\r\n  background-color: black;\r\n  opacity: 0.7;\r\n}\r\n\r\n__selector__ .highlight {\r\n  fill: #ff2727 !important;\r\n}\r\n\r\n__selector__ .selected {\r\n  fill: #d12020 !important;\r\n  stroke: #777777 !important;\r\n  stroke-width: 1 !important;\r\n}\r\n`,\n};\n","import { generateId } from '../utils';\nimport { styles, themes } from './generated-styles';\n\n// modifed from https://github.com/egoist/style-inject\nexport function styleInject(selector: string, theme: string, insertAt = 'top') {\n  let css = styles + (themes as any)[theme];\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  // replace with selector\n  css = css.split('__selector__').join(selector);\n\n  const head = document.head || document.getElementsByTagName('head')[0];\n  const style = document.createElement('style') as HTMLStyleElement | any;\n  style.id = generateId('styles');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n\n  return style.id;\n}\n","import { elements } from '../renderer';\r\nimport { Store } from '../store';\r\nimport { Ticker } from '../ticker';\r\nimport { hideElement, getElement, getClicks } from '../utils';\r\nimport { DOMCustomEvent, EventType, Event, TickDetails } from './models';\r\n\r\nexport function registerEvents(store: Store, ticker: Ticker) {\r\n  const root = document.querySelector(store.getState().options.selector) as HTMLElement;\r\n  const events: Event[] = [];\r\n  register();\r\n\r\n  return { reregister, unregister, addApiEventHandler };\r\n\r\n  function register() {\r\n    registerControlButtonEvents();\r\n    registerOverlayEvents();\r\n    registerClickEvents();\r\n    registerKeyboardEvents();\r\n  }\r\n\r\n  function reregister() {\r\n    unregister(false);\r\n    register();\r\n  }\r\n\r\n  function registerControlButtonEvents() {\r\n    addEventHandler(root, elements.skipBack, 'click', () => ticker.skipBack());\r\n    addEventHandler(root, elements.play, 'click', () => ticker.start());\r\n    addEventHandler(root, elements.pause, 'click', () => ticker.stop());\r\n    addEventHandler(root, elements.skipForward, 'click', () => ticker.skipForward());\r\n  }\r\n\r\n  function registerOverlayEvents() {\r\n    addEventHandler(root, elements.overlayPlay, 'click', () => {\r\n      hideElement(root, elements.overlay);\r\n      ticker.start();\r\n    });\r\n    addEventHandler(root, elements.overlayRepeat, 'click', () => {\r\n      hideElement(root, elements.overlay);\r\n      ticker.skipBack();\r\n      ticker.start();\r\n    });\r\n  }\r\n\r\n  function registerClickEvents() {\r\n    if (store.getState().options.mouseControls) {\r\n      const svg = root.querySelector('svg') as SVGSVGElement;\r\n      svg.addEventListener('click', (clickEvent) => {\r\n        // ignore clicks to group legends\r\n        const target = clickEvent.target as HTMLElement;\r\n        if (!target || target.classList.contains('legend')) return;\r\n\r\n        getClicks(clickEvent, function (event: any) {\r\n          const clicks = event.detail;\r\n          if (clicks === 3) {\r\n            ticker.skipBack();\r\n          } else if (clicks === 2) {\r\n            ticker.skipForward();\r\n          } else {\r\n            ticker.toggle();\r\n          }\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  function registerKeyboardEvents() {\r\n    if (store.getState().options.keyboardControls) {\r\n      addEventHandler(document, '', 'keyup', handleKeyboardEvents);\r\n    }\r\n  }\r\n\r\n  function handleKeyboardEvents(e: KeyboardEvent) {\r\n    // ignore keyboard when user is typing in input or textarea\r\n    const target = document.activeElement;\r\n    if (target && ['input', 'textarea'].includes(target.tagName.toLowerCase())) return;\r\n\r\n    const keys = {\r\n      spacebar: ' ',\r\n      A: 'a',\r\n      S: 's',\r\n      D: 'd',\r\n    };\r\n\r\n    switch (e.key) {\r\n      case keys.spacebar:\r\n        ticker.toggle();\r\n        e.preventDefault(); // prevent scroll triggered by spacebar\r\n        break;\r\n      case keys.A:\r\n        ticker.skipBack();\r\n        break;\r\n      case keys.S:\r\n        ticker.toggle();\r\n        break;\r\n      case keys.D:\r\n        ticker.skipForward();\r\n        break;\r\n    }\r\n  }\r\n\r\n  function unregister(removeUserDefined = true) {\r\n    events\r\n      .filter((event) => (removeUserDefined ? true : !event.userDefined))\r\n      .forEach((event) => {\r\n        event.element.removeEventListener(event.eventType, event.handler);\r\n        events.splice(events.indexOf(event), 1);\r\n      });\r\n  }\r\n\r\n  function addEventHandler(\r\n    root: HTMLElement | HTMLDocument,\r\n    className: string,\r\n    eventType: Event['eventType'],\r\n    handler: (e?: any) => void,\r\n  ) {\r\n    const element = getElement(root, className);\r\n    if (element) {\r\n      element.addEventListener(eventType, handler);\r\n      events.push({\r\n        element,\r\n        userDefined: false,\r\n        eventType,\r\n        handler,\r\n      });\r\n    }\r\n  }\r\n\r\n  function addApiEventHandler(eventType: EventType, handler: () => void) {\r\n    root.addEventListener(eventType, handler);\r\n    events.push({\r\n      element: root,\r\n      userDefined: true,\r\n      eventType,\r\n      handler,\r\n    });\r\n  }\r\n}\r\n\r\nexport function getTickDetails(store: Store): TickDetails {\r\n  const { ticker, data } = store.getState();\r\n  return {\r\n    date: ticker.currentDate,\r\n    isFirstDate: ticker.isFirstDate,\r\n    isLastDate: ticker.isLastDate,\r\n    isRunning: ticker.isRunning,\r\n    allDates: data.datesCache,\r\n  };\r\n}\r\n\r\nfunction dispatchDOMEvent(store: Store, eventType: EventType) {\r\n  const element = document.querySelector(store.getState().options.selector) as HTMLElement;\r\n  if (!element) return;\r\n  element.dispatchEvent(\r\n    new CustomEvent(eventType, {\r\n      bubbles: true,\r\n      detail: getTickDetails(store),\r\n    } as DOMCustomEvent),\r\n  );\r\n}\r\n\r\nexport function DOMEventSubscriber(store: Store) {\r\n  let lastDate = '';\r\n  let wasRunning: boolean;\r\n  return function () {\r\n    const currentDate = store.getState().ticker.currentDate;\r\n    const isRunning = store.getState().ticker.isRunning;\r\n    if (currentDate !== lastDate) {\r\n      dispatchDOMEvent(store, 'dateChange');\r\n      if (store.getState().ticker.isFirstDate) {\r\n        dispatchDOMEvent(store, 'firstDate');\r\n      }\r\n      if (store.getState().ticker.isLastDate) {\r\n        dispatchDOMEvent(store, 'lastDate');\r\n      }\r\n      lastDate = currentDate;\r\n    }\r\n    if (!wasRunning && isRunning) {\r\n      dispatchDOMEvent(store, 'play');\r\n    }\r\n    if (wasRunning && !isRunning) {\r\n      dispatchDOMEvent(store, 'pause');\r\n    }\r\n    wasRunning = isRunning;\r\n  };\r\n}\r\n","import * as d3 from './d3';\r\nimport { getDateString, prepareData, computeNextDateSubscriber, safeName } from './utils';\r\nimport { Data, WideData } from './data';\r\nimport { createRenderer, rendererSubscriber, Renderer } from './renderer';\r\nimport { createTicker } from './ticker';\r\nimport { styleInject } from './styles';\r\nimport { actions, createStore, rootReducer, Store } from './store';\r\nimport { Options } from './options';\r\nimport { registerEvents, DOMEventSubscriber, getTickDetails, EventType } from './events';\r\nimport { Race, ApiMethod, ApiCallback } from './models';\r\n\r\nexport function race(data: Data[] | WideData[], options: Partial<Options> = {}): Race {\r\n  if (!data || !Array.isArray(data) || data.length === 0) {\r\n    throw new Error('No valid data supplied.');\r\n  }\r\n\r\n  const store = createStore(rootReducer);\r\n  store.dispatch(actions.options.loadOptions(options));\r\n  const ticker = createTicker(store);\r\n  let preparedData = prepareData(data, store);\r\n  let renderer = createRenderer(preparedData, store);\r\n\r\n  const { selector, injectStyles, theme, autorun } = store.getState().options;\r\n\r\n  const root = document.querySelector(selector) as HTMLElement;\r\n  if (!root) throw new Error('No element found with the selector: ' + selector);\r\n\r\n  const apiSubscriptions: Array<() => void> = [];\r\n  subscribeToStore(store, renderer, preparedData);\r\n\r\n  let stylesId: string;\r\n  if (injectStyles) {\r\n    stylesId = styleInject(selector, theme);\r\n  }\r\n\r\n  renderer.renderInitalView();\r\n  ticker.start();\r\n  if (!autorun) {\r\n    ticker.stop();\r\n  }\r\n\r\n  const events = registerEvents(store, ticker);\r\n  window.addEventListener('resize', resize);\r\n\r\n  function subscribeToStore(store: Store, renderer: Renderer, data: Data[]) {\r\n    const subscriptions = [\r\n      rendererSubscriber(store, renderer),\r\n      computeNextDateSubscriber(data, store),\r\n      DOMEventSubscriber(store),\r\n    ];\r\n    [...subscriptions, ...apiSubscriptions].forEach((subcsription) => {\r\n      store.subscribe(subcsription);\r\n    });\r\n  }\r\n\r\n  function addApiSubscription(fn: () => void) {\r\n    apiSubscriptions.push(fn);\r\n    store.subscribe(fn);\r\n  }\r\n\r\n  function resize() {\r\n    renderer.resize();\r\n    events.reregister();\r\n  }\r\n\r\n  function destroyed() {\r\n    throw new Error('Cannot perform this operation after calling destroy()');\r\n  }\r\n\r\n  const API = {\r\n    // TODO: validate user input\r\n    play() {\r\n      if (!store.getState().ticker.isRunning) {\r\n        ticker.start();\r\n      }\r\n      return this;\r\n    },\r\n    pause() {\r\n      ticker.stop();\r\n      return this;\r\n    },\r\n    toggle() {\r\n      ticker.toggle();\r\n      return this;\r\n    },\r\n    skipBack() {\r\n      ticker.skipBack();\r\n      return this;\r\n    },\r\n    skipForward() {\r\n      ticker.skipForward();\r\n      return this;\r\n    },\r\n    inc(value = 1) {\r\n      store.dispatch(actions.ticker.inc(+value));\r\n      return this;\r\n    },\r\n    dec(value = 1) {\r\n      store.dispatch(actions.ticker.dec(+value));\r\n      return this;\r\n    },\r\n    setDate(inputDate: string | Date) {\r\n      store.dispatch(actions.ticker.updateDate(getDateString(inputDate)));\r\n      return this;\r\n    },\r\n    getDate() {\r\n      return store.getState().ticker.currentDate;\r\n    },\r\n    getAllDates() {\r\n      return [...store.getState().ticker.dates];\r\n    },\r\n    isRunning() {\r\n      return store.getState().ticker.isRunning;\r\n    },\r\n    select(name: string) {\r\n      d3.select(root)\r\n        .select('rect.' + safeName(name))\r\n        .classed('selected', true);\r\n      store.dispatch(actions.data.addSelection(name));\r\n      return this;\r\n    },\r\n    unselect(name: string) {\r\n      d3.select(root)\r\n        .select('rect.' + safeName(name))\r\n        .classed('selected', false);\r\n      store.dispatch(actions.data.removeSelection(name));\r\n      return this;\r\n    },\r\n    unselectAll() {\r\n      d3.select(root).selectAll('rect').classed('selected', false);\r\n      store.dispatch(actions.data.resetSelections());\r\n      return this;\r\n    },\r\n    hideGroup(group: string) {\r\n      store.dispatch(actions.data.addFilter(String(group)));\r\n      return this;\r\n    },\r\n    showGroup(group: string) {\r\n      store.dispatch(actions.data.removeFilter(String(group)));\r\n      return this;\r\n    },\r\n    showOnlyGroup(group: string) {\r\n      store.dispatch(actions.data.allExceptFilter(String(group)));\r\n      return this;\r\n    },\r\n    showAllGroups() {\r\n      store.dispatch(actions.data.resetFilters());\r\n      return this;\r\n    },\r\n    changeOptions(newOptions: Partial<Options>) {\r\n      const unAllowedOptions: Array<keyof Options> = ['selector', 'dataShape'];\r\n      unAllowedOptions.forEach((key) => {\r\n        if (newOptions[key] && newOptions[key] !== store.getState().options[key]) {\r\n          throw new Error(`The option \"${key}\" cannot be changed.`);\r\n        }\r\n      });\r\n\r\n      const dataOptions: Array<keyof Options> = [\r\n        'dataTransform',\r\n        'fillDateGapsInterval',\r\n        'fillDateGapsValue',\r\n        'startDate',\r\n        'endDate',\r\n        'fixedOrder',\r\n      ];\r\n      let dataOptionsChanged = false;\r\n      dataOptions.forEach((key) => {\r\n        if (newOptions[key] && newOptions[key] !== store.getState().options[key]) {\r\n          dataOptionsChanged = true;\r\n        }\r\n      });\r\n\r\n      store.dispatch(actions.options.changeOptions(newOptions));\r\n      const { injectStyles, theme, autorun } = store.getState().options;\r\n\r\n      if (dataOptionsChanged) {\r\n        store.unsubscribeAll();\r\n        store.dispatch(actions.data.clearDateSlices());\r\n        preparedData = prepareData(data as Data[], store, true);\r\n        renderer = createRenderer(preparedData, store);\r\n        subscribeToStore(store, renderer, preparedData);\r\n      }\r\n\r\n      if ('injectStyles' in newOptions || 'theme' in newOptions) {\r\n        document.getElementById(stylesId)?.remove();\r\n        if (injectStyles) {\r\n          stylesId = styleInject(selector, theme);\r\n        }\r\n      }\r\n\r\n      renderer.renderInitalView();\r\n      events.reregister();\r\n\r\n      if (autorun) {\r\n        const { isFirstDate, isRunning } = store.getState().ticker;\r\n        if (isFirstDate && !isRunning) {\r\n          ticker.start();\r\n        }\r\n      }\r\n\r\n      return this;\r\n    },\r\n    call(fn: ApiCallback) {\r\n      fn.call(API, getTickDetails(store));\r\n      return this;\r\n    },\r\n    delay(duration = 0) {\r\n      let queue: Array<{ fn: ApiMethod; args: unknown[] }> = [];\r\n      let newQueue: Array<{ fn: ApiMethod; args: unknown[] }> = [];\r\n      const originalMethods: any = {};\r\n      let destroyCalled = false;\r\n\r\n      for (const method of Object.keys(this)) {\r\n        if (typeof this[method] !== 'function') continue;\r\n        originalMethods[method] = this[method];\r\n        this[method] = (...args: unknown[]) => {\r\n          addToQueue(originalMethods[method], args);\r\n          return this;\r\n        };\r\n      }\r\n\r\n      function addToQueue(fn: ApiMethod, args: unknown[]) {\r\n        if (!destroyCalled) {\r\n          queue.push({ fn, args });\r\n        } else {\r\n          queue.push({ fn: destroyed, args: [] });\r\n        }\r\n        if (fn.name === 'destroy') {\r\n          destroyCalled = true;\r\n        }\r\n      }\r\n\r\n      function asValidNumber(duration: unknown) {\r\n        return isNaN(Number(duration)) || Number(duration) < 0 ? 0 : Number(duration);\r\n      }\r\n\r\n      (function runQueue(dur: number) {\r\n        setTimeout(() => {\r\n          let queueItem = queue.shift();\r\n          let newDuration = 0;\r\n          while (queueItem) {\r\n            if (queueItem.fn.name !== 'delay') {\r\n              queueItem.fn(...queueItem.args);\r\n            } else {\r\n              newQueue = [...queue];\r\n              queue = [];\r\n              newDuration = asValidNumber(queueItem.args[0]);\r\n            }\r\n            queueItem = queue.shift();\r\n          }\r\n\r\n          if (newQueue.length > 0) {\r\n            queue = [...newQueue];\r\n            newQueue = [];\r\n            runQueue(newDuration);\r\n          } else {\r\n            for (const method of Object.keys(originalMethods)) {\r\n              this[method] = originalMethods[method];\r\n            }\r\n          }\r\n        }, dur);\r\n      })(asValidNumber(duration));\r\n\r\n      return this;\r\n    },\r\n    onDate(date: string | Date, fn: ApiCallback) {\r\n      const dateString = getDateString(date);\r\n      let lastDate = '';\r\n      addApiSubscription(() => {\r\n        if (store.getState().ticker.currentDate === dateString && dateString !== lastDate) {\r\n          lastDate = store.getState().ticker.currentDate; // avoid infinite loop if fn dispatches action\r\n          fn.call(API, getTickDetails(store));\r\n        }\r\n        lastDate = store.getState().ticker.currentDate;\r\n      });\r\n      return this;\r\n    },\r\n    on(event: EventType, fn: ApiCallback) {\r\n      events.addApiEventHandler(event, () => {\r\n        fn.call(API, getTickDetails(store));\r\n      });\r\n      return this;\r\n    },\r\n    destroy() {\r\n      ticker.stop();\r\n      store.unsubscribeAll();\r\n      events.unregister();\r\n      window.removeEventListener('resize', resize);\r\n      root.innerHTML = '';\r\n      document.getElementById(stylesId)?.remove();\r\n      for (const method of Object.keys(this)) {\r\n        this[method] = destroyed;\r\n      }\r\n      return this;\r\n    },\r\n  };\r\n\r\n  return API;\r\n}\r\n","import { loadData, Data, WideData, Options, defaultOptions, Race } from '..';\r\n\r\nexport function processProps(props: any, elementId: string) {\r\n  const selector = '#' + elementId;\r\n  const { data, dataUrl, dataType, callback, ...attr } = props;\r\n  const options: Partial<Options> = { ...attr, selector };\r\n\r\n  let dataPromise: Promise<Data[]> | Promise<WideData[]>;\r\n  if (dataUrl && !data) {\r\n    dataPromise = loadData(dataUrl, dataType);\r\n  } else if (isPromise(data)) {\r\n    dataPromise = data;\r\n  } else {\r\n    dataPromise = Promise.resolve(data);\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  const cb = callback && typeof callback === 'function' ? callback : (_racer: Race) => {};\r\n\r\n  return {\r\n    dataPromise,\r\n    options,\r\n    callback: cb,\r\n  };\r\n}\r\n\r\nfunction isPromise(p: any) {\r\n  return Boolean(p && typeof p.then === 'function');\r\n}\r\n\r\n/**\r\n * Type for component props.\r\n * Extends [[Options]]\r\n * Defines props passed to components (angular/react/vue).\r\n * See [options documentations](/docs/documentation/options) for the rest of props.\r\n */\r\nexport class Props extends Options {\r\n  /** Data array */\r\n  public data!: Data[] | WideData[];\r\n\r\n  /** Url to fetch data from. This is ignored if [[Props.data]] is specified. */\r\n  public dataUrl!: string;\r\n\r\n  /** Type of data fetched from Url by [[Props.dataUrl]] */\r\n  public dataType!: 'json' | 'csv' | 'tsv' | 'xml';\r\n\r\n  /** An `id` to assign to the generated DOM element */\r\n  public elementId!: string;\r\n\r\n  /** Content to show till the chart loads. This can accept HTML. */\r\n  public loadingContent!: string;\r\n\r\n  /** Callback function that is executed after the chart loads.\r\n   *\r\n   * @param racer chart object ([[Race]]). Exposes the chart API.\r\n   * @param data data array. The data used by the chart before any transformation\r\n   */\r\n  public callback!: (racer: Race, data: Data[] | WideData[]) => void;\r\n}\r\n\r\nexport const defaultProps: Props = {\r\n  ...defaultOptions,\r\n  data: (undefined as unknown) as Data[],\r\n  dataUrl: (undefined as unknown) as string,\r\n  dataType: (undefined as unknown) as 'json',\r\n  elementId: (undefined as unknown) as string,\r\n  loadingContent: 'Loading...',\r\n  callback: (undefined as unknown) as () => {},\r\n};\r\n"],"names":["loadData","URL","type","d3","Error","actionTypes","loadOptions","changeOptions","options","payload","Options","dataLoaded","addFilter","removeFilter","toggleFilter","resetFilters","allExceptFilter","addSelection","removeSelection","toggleSelection","resetSelections","addDateSlice","clearDateSlices","dataCollections","group","selection","date","dateSlice","triggerRender","initialState","names","groups","datesCache","groupFilter","selected","dateSlices","dataReducer","state","action","addToArray","removeFromArray","toggleItem","array","item","arr","includes","push","filter","x","initialize","changeDates","updateDate","setRunning","setFirst","setLast","inc","dec","dates","currentDate","running","value","isRunning","isFirstDate","isLastDate","tickerReducer","indexOf","length","sort","currentIndex","lastIndex","incValue","newDate","decValue","createTicker","store","ticker","start","justStarted","showRace","getState","tickDuration","dispatch","actions","_","loop","stop","skipBack","skipForward","toggle","goToDate","data","rootReducer","optionsReducer","createStore","reducer","preloadedState","notifySubscribers","subscribers","subscribe","fn","index","unsubscribe","splice","forEach","unsubscribeAll","getColor","d","showGroups","colorSeed","colorMap","color","useGroup","Boolean","values","shuffle","toNumber","currentValue","name","Array","isArray","negativeIfOdd","lumVariation","random","HueSpacing","hue","getIconID","safeName","zeroPad","n","w","toString","s","String","nums","i","charCodeAt","InputSeed","seed","Math","sin","floor","m","t","generateId","prefix","rnd","fill","map","substr","join","slice","getHeight","element","minHeight","height","newHeight","getBoundingClientRect","startsWith","scale","split","window","innerHeight","getWidth","minWidth","width","newWidth","innerWidth","getElement","root","className","undefined","querySelector","showElement","useVisibility","style","visibility","display","hideElement","getText","param","isDate","formatDate","replace","toggleClass","selector","select","classed","debounce","func","wait","immediate","timeout","_clicks","_Fn","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","getClicks","event","Fn","pipe","reduce","f","g","getDates","from","Set","getDateString","inputDate","Date","isNaN","year","getFullYear","month","getMonth","day","getDate","dateStr","format","weekDayIndex","getDay","monthNames","weekDays","getDateRange","date1","date2","interval","range","daysInMonth","sameDay","sameMonth","numberOfMonths","count","numberOfYears","outputRange","round","getNextDate","prepareData","changingOptions","customDataTransform","dataTransform","filterByDate","startDate","endDate","wideDataToLong","dataShape","processFixedOrder","fixedOrder","validateAndSort","fillDateGaps","fillDateGapsInterval","fillDateGapsValue","topN","calculateLastValues","storeDataCollections","transformFn","rank","a","b","localeCompare","fillGaps","acc","curr","lastValue","last","nested","long","row","Object","entries","key","longDataToWide","wide","dateRow","r","details","fillValue","wideData","allData","lastDate","rangeStep","iData","interpolateTopN","newData","j","newRow","data1","data2","topData1","getTopN","topData2","topNames","filteredData1","filteredData2","keys","getDateSlice","getRank","emptyData","filterGroups","computeNextDateSubscriber","nextDate","defaultOptions","mouseControls","keyboardControls","autorun","injectStyles","title","subTitle","caption","dateCounter","labelsPosition","labelsWidth","showIcons","controlButtons","overlays","inputHeight","inputWidth","marginTop","marginRight","marginBottom","marginLeft","theme","fixedScale","highlightBars","selectBars","excludedKeys","Number","calculateDimensions","renderOptions","maxValue","titlePadding","titleHeight","subTitleHeight","groupsHeight","controlsHeight","headerHeight","max","labelsArea","topAxisPadding","margin","top","right","bottom","left","domain","y","barPadding","labelPadding","barWidth","abs","barHeight","barHalfHeight","barY","iconSize","iconSpace","labelX","halo","text","svg","selectAll","remove","parentNode","insertBefore","cloneNode","legendClick","clicks","detail","highlightFn","selectFn","renderHeader","CompleteDateSlice","titleText","append","attr","html","subTitleText","legendsWrapper","legends","enter","on","legendX","legendY","each","wrapper","bbox","node","getBBox","elements","controls","play","pause","overlay","overlayPlay","overlayRepeat","buttons","renderControls","elementWidth","controlButtonIcons","updateControls","renderOverlays","overlayButtonIcons","renderInitalView","document","lastDateIndex","innerHTML","renderInitialFrame","val","xAxis","ticks","tickSize","tickFormat","call","defs","icon","endY","endX","dateCounterTextY","dateCounterText","captionText","renderFrame","transition","duration","ease","bars","exit","labels","valueLabels","sameDate","tween","textContent","iconPatterns","icons","resize","currentPosition","position","createRenderer","rendererSubscriber","renderer","styles","themes","styleInject","insertAt","css","head","getElementsByTagName","createElement","id","firstChild","appendChild","styleSheet","cssText","createTextNode","registerEvents","events","register","reregister","unregister","addApiEventHandler","registerControlButtonEvents","registerOverlayEvents","registerClickEvents","registerKeyboardEvents","addEventHandler","addEventListener","clickEvent","target","classList","contains","handleKeyboardEvents","e","activeElement","tagName","toLowerCase","spacebar","A","S","D","preventDefault","removeUserDefined","userDefined","removeEventListener","eventType","handler","getTickDetails","allDates","dispatchDOMEvent","dispatchEvent","CustomEvent","bubbles","DOMEventSubscriber","wasRunning","race","preparedData","apiSubscriptions","subscribeToStore","stylesId","subscriptions","subcsription","addApiSubscription","destroyed","API","setDate","getAllDates","unselect","unselectAll","hideGroup","showGroup","showOnlyGroup","showAllGroups","newOptions","unAllowedOptions","dataOptions","dataOptionsChanged","getElementById","delay","queue","newQueue","originalMethods","destroyCalled","method","addToQueue","asValidNumber","runQueue","dur","queueItem","shift","newDuration","onDate","dateString","destroy","Props","defaultProps","dataUrl","dataType","elementId","loadingContent","callback"],"mappings":"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"}